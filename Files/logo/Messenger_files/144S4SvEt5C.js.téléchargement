if (self.CavalryLogger) { CavalryLogger.start_js(["JvtAYMg"]); }

__d("CometSSRServerJSPayloadUtils",["ErrorGuard","HasteSupportData","ServerJS"],(function(a,b,c,d,e,f){"use strict";f.handlePayload=a;f.invokeAndCaptureReturnValue=c;var g,h="";function a(a){b("HasteSupportData").handle(a.hsdp);(g||(g=b("ErrorGuard"))).skipGuardGlobal(!0);new(b("ServerJS"))().handle(a.jsmods);return h}function c(c,d,f){var a;typeof c==="string"?a=b.call(null,c):a=c;c=a[d].apply(a,f);c===void 0&&(c="");h=JSON.stringify(c)}}),null);
__d("RequestStreamCloseReason",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UserIntention","StartStreamFailure","StreamError","RemoteTermination","ServerDataEnd","ServerDrain","ReestablishError","ClientError"]);f.RequestStreamCloseReason=a}),null);
__d("DGWRequestStreamUtils",["Base64"],(function(a,b,c,d,e,f){"use strict";f.convertHeaders=a;f.cleanHeaders=g;f.getAuxIdFromPayload=c;f.transformContextWithRewriteDelta=d;function a(a,c,d,e){var f={};a=Object.entries(a);for(var g=0;g<a.length;g++){var h=a[g],i=h[0];h=h[1];typeof h=="string"?f["XRSS-"+i]=h:typeof h=="number"?f["XRSN-"+i]=h.toString():typeof h=="boolean"?f["XRSB-"+i]=h.toString():typeof h=="object"&&h!=null&&(f["XRSO-"+i]=b("Base64").encode(JSON.stringify(h)))}c&&(f["xrs-body"]="true");d!=null&&d.length>0&&(f["xrs-instrumentation"]=b("Base64").encode(d));f["XRS-Accept-Ack"]="RSAck";e!=null&&e.ackTimeoutSec!=null&&(f["XRS-SRAck-Timeout"]=e.ackTimeoutSec.toString());return f}function g(a){return Object.keys(a).reduce(function(b,c){(typeof a[c]==="string"||typeof a[c]==="boolean"||typeof a[c]==="number"||typeof a[c]==="object")&&(b[c]=a[c]);return b},{})}function c(a){if(a.response&&a.response.instrumentation_data!=null&&a.response.instrumentation_data.length>0)try{a=JSON.parse(new TextDecoder("utf-8").decode(a.response.instrumentation_data));return a.auxId}catch(a){}return null}function d(a,b,c){var d=a.headers;a=a.body;b.kill_body===!0&&(a=null);b.new_body!=null&&(a=b.new_body);if(b.new_headers!=null)try{d=g(JSON.parse(b.new_headers))}catch(a){c==null?void 0:c.warn("rewrite new_headers not valid json")}if(b.patch_headers!=null)try{d=babelHelpers["extends"]({},d,g(JSON.parse(b.patch_headers)))}catch(a){c==null?void 0:c.warn("rewrite patch_headers not valid json")}return{headers:d,body:a}}}),null);
__d("DGWStream",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";f.streamErrorToString=a;var g=b("$InternalEnum").Mirrored(["ABNORMAL_CLOSURE","GOING_AWAY","SERVER_INTERNAL_ERROR","PREMATURE_CLOSE","UNKNOWN_ERROR","KEEPALIVE_TIMEOUT","TRANSPORT_CLOSED_BEFORE_STREAM_INIT"]);f.StreamError=g;function a(a){switch(a){case g.ABNORMAL_CLOSURE:return"ABNORMAL_CLOSURE";case g.GOING_AWAY:return"GOING_AWAY";case g.SERVER_INTERNAL_ERROR:return"SERVER_INTERNAL_ERROR";case g.PREMATURE_CLOSE:return"PREMATURE_CLOSE";case g.UNKNOWN_ERROR:return"UNKNOWN_ERROR";case g.KEEPALIVE_TIMEOUT:return"KEEPALIVE_TIMEOUT";case g.TRANSPORT_CLOSED_BEFORE_STREAM_INIT:return"TRANSPORT_CLOSED_BEFORE_STREAM_INIT"}}}),null);
__d("DGWAuth",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";f.fromStringToDGWAuth=a;f.fromDGWAuthToString=c;var g=b("$InternalEnum")({TEST:"0:0",FACEBOOK:"1:0"});f.DGWAuth=g;function a(a){if(a==="TEST")return g.TEST;else if(a==="FACEBOOK")return g.FACEBOOK;else{a=new Error("failed to convert string ("+a+") to DGWAuth Type");a.stack;throw a}}function c(a){if(a===g.FACEBOOK)return"FACEBOOK";else return"TEST"}}),null);
__d("DgwClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f){"use strict";a=b("getFalcoLogPolicy_DO_NOT_USE")("1755537");c=b("FalcoLoggerInternal").create("dgw_client",a);e.exports=c}),null);
__d("DGWLoggingContext",["$InternalEnum","DgwClientFalcoEvent","ODS","Random"],(function(a,b,c,d,e,f){"use strict";a="dgw_client";f.DGW_MODULE=a;c=b("$InternalEnum")({STREAM_COMPONENT:"WebStream",STREAM_GROUP_COMPONENT:"WebStreamGroup",GROUPED_STREAM_COMPONENT:"GroupedWebStream",WEBSOCKET_TRANSPORT_COMPONENT:"WebSocketTransport",ACK_MANAGER_COMPONENT:"WebStreamAckManager",CODEC_COMPONENT:"WebCodec"});f.DGWLoggingComponent=c;d=function(){function a(a,b,c,d,e,f){f===void 0&&(f=!1),this.$5=a,this.$1=b,this.$4=c,this.$3=d,this.$6=e,this.$2=f}var c=a.prototype;c.bumpODSKey=function(a,c,d){d===void 0&&(d=1);if(!b("Random").coinflip(d))return;a=a+"."+c;b("ODS").bumpEntityKey(3589,"dgw_web_client",a,d)};c.logEvent=function(a,b,c){this.$2||this.$7(a,b,null,c)};c.$7=function(a,c,d,e){var f=this;(this.$1!=null||this.$6!=null)&&b("DgwClientFalcoEvent").log(function(){return{event:c,logging_id:f.$1,dgw_version:f.$5,error:d,uuid:f.$3,dgw_component:a,extra_info:e,destination_tier:f.$4,sg_transport_id:f.$6}})};c.logError=function(a,b,c,d){this.$2||this.$7(a,b,c,d)};c.logWarn=function(a,b,c,d){this.$2||this.$7(a,b,c,d)};return a}();f.DGWLoggingContext=d}),null);
__d("DGWAckManager",["DGWLoggingContext","Promise","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=function(){var b=a.prototype;b.stopTracking=function(a){clearTimeout(this.$1),this.$3(a)};function a(a,b,c){var d=this;this.$3=c;this.sendId=a;this.$2=b;this.handleAckReceived=function(){d.stopTracking(!0)};this.$1=setTimeout(function(){d.stopTracking(!1)},b)}return a}();a=function(){function a(a){this.$1=new Map(),this.$2=a}var c=a.prototype;c.waitForAck=function(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d=this.$1;f.prev=1;f.next=4;return b("regeneratorRuntime").awrap(new(b("Promise"))(function(b,e){d.set(a,new g(a,c,b))}));case 4:e=f.sent;e===!0?this.$2.logEvent(b("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Received ACK","sendId: "+a):this.$2.logWarn(b("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ACK timeout","Request "+a+" timed out after "+c+"ms");d["delete"](a);return f.abrupt("return",e);case 10:f.prev=10;f.t0=f["catch"](1);d["delete"](a);throw f.t0;case 14:case"end":return f.stop()}},null,this,[[1,10]])};c.handleAckReceived=function(a){var c=this.$1.get(a);if(c===void 0){this.$2.logWarn(b("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"untracked ACK","Received ACK for ackId "+a+" which was not being tracked");return}c.handleAckReceived()};c.clearPendingAcks=function(){var a=this;this.$1.forEach(function(c,d,e){a.$2.logEvent(b("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Clearing pending ACK with ackId "+c.sendId),c.stopTracking(!1),e["delete"](d)})};return a}();f.DGWAckManager=a}),null);
__d("DGWConstants",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";f.drainReasonToDrainReasonString=a;f.DgwCodecReturnCodeToString=c;f.frameTypeToString=d;e=3e4;f.DEFAULT_ACK_TIMEOUT_MS=e;a="prod";f.DEFAULT_SERVICE_TIER=a;c=128;f.MAX_ACK_ID=c;e=(d=b("$InternalEnum"))({NORMAL_CLOSURE:1e3,GOING_AWAY:1001,ABNORMAL_CLOSURE:1006,SERVER_INTERNAL_ERROR:1011,DGW_NORMAL_CLOSURE:4e3,DGW_PING_TIMEOUT:4001});f.WebsocketCloseCodes=e;var g=d({DrainReason_ELB:0,DrainReason_SLB:1,DrainReason_AppServerPush:2,DrainReason_GracePeriodExpired:3,DrainReason_Unknown:4});f.DrainReason=g;function a(a){switch(a){case g.DrainReason_ELB:return"DrainReason_ELB";case g.DrainReason_SLB:return"DrainReason_SLB";case g.DrainReason_AppServerPush:return"DrainReason_AppServerPush";case g.DrainReason_GracePeriodExpired:return"DrainReason_GracePeriodExpired";case g.DrainReason_Unknown:return"DrainReason_Unknown"}}var h=d({DgwCodecReturnCode_Success:0,DgwCodecReturnCode_Failure:1,DgwCodecReturnCode_NotEnoughData:2,DgwCodecReturnCode_OutOfMemory:3,DgwCodecReturnCode_AckIdOutOfBounds:4,DgwCodecReturnCode_InvalidParameter:5,DgwCodecReturnCode_InvalidFrameType:6,DgwCodecReturnCode_InvalidAckFrameLength:7,DgwCodecReturnCode_InvalidDrainReason:8,DgwCodecReturnCode_InvalidDataFrameLength:9,DgwCodecReturnCode_InvalidDrainFrameLength:10});f.DgwCodecReturnCode=h;function c(a){switch(a){case h.DgwCodecReturnCode_Success:return"DgwCodecReturnCode_Success";case h.DgwCodecReturnCode_Failure:return"DgwCodecReturnCode_Failure";case h.DgwCodecReturnCode_NotEnoughData:return"DgwCodecReturnCode_NotEnoughData";case h.DgwCodecReturnCode_OutOfMemory:return"DgwCodecReturnCode_OutOfMemory";case h.DgwCodecReturnCode_AckIdOutOfBounds:return"DgwCodecReturnCode_AckIdOutOfBounds";case h.DgwCodecReturnCode_InvalidParameter:return"DgwCodecReturnCode_InvalidParameter";case h.DgwCodecReturnCode_InvalidFrameType:return"DgwCodecReturnCode_InvalidFrameType";case h.DgwCodecReturnCode_InvalidAckFrameLength:return"DgwCodecReturnCode_InvalidAckFrameLength";case h.DgwCodecReturnCode_InvalidDrainReason:return"DgwCodecReturnCode_InvalidDrainReason";case h.DgwCodecReturnCode_InvalidDataFrameLength:return"DgwCodecReturnCode_InvalidDataFrameLength";case h.DgwCodecReturnCode_InvalidDrainFrameLength:return"DgwCodecReturnCode_InvalidDrainFrameLength"}}var i=d({DgwFrameType_Data:0,DgwFrameType_Ack:1,DgwFrameType_Empty:2,DgwFrameType_Drain:3,DgwFrameType_Deauth:4,DgwFrameType_StreamGroup_EstablishStream:5,DgwFrameType_StreamGroup_Data:6,DgwFrameType_StreamGroup_Ack:7,DgwFrameType_StreamGroup_EndOfData:8,DgwFrameType_Ping:9,DgwFrameType_Pong:10});f.DgwFrameType=i;function d(a){switch(a){case i.DgwFrameType_Data:return"DgwFrameType_Data";case i.DgwFrameType_Ack:return"DgwFrameType_Ack";case i.DgwFrameType_Empty:return"DgwFrameType_Empty";case i.DgwFrameType_Drain:return"DgwFrameType_Drain";case i.DgwFrameType_Deauth:return"DgwFrameType_Deauth";case i.DgwFrameType_StreamGroup_EstablishStream:return"DgwFrameType_StreamGroup_EstablishStream";case i.DgwFrameType_StreamGroup_Data:return"DgwFrameType_StreamGroup_Data";case i.DgwFrameType_StreamGroup_Ack:return"DgwFrameType_StreamGroup_Ack";case i.DgwFrameType_StreamGroup_EndOfData:return"DgwFrameType_StreamGroup_EndOfData";case i.DgwFrameType_Ping:return"DgwFrameType_Ping";case i.DgwFrameType_Pong:return"DgwFrameType_Pong"}}a={HEADER_APPID:"x-dgw-appid",HEADER_APPVERSION:"x-dgw-appversion",HEADER_AUTHTYPE:"x-dgw-authtype",HEADER_AUTHTOKEN:"Authorization",HEADER_DGW_VERSION:"x-dgw-version",HEADER_LOGGING_ID:"x-dgw-loggingid",HEADER_REGIONHINT:"x-dgw-regionhint",HEADER_TARGET_TIER:"x-dgw-tier",HEADER_UUID:"x-dgw-uuid",kShadowHeader:"x-dgw-shadow",APPHEADER_PREFIX:"x-dgw-app-"};f.HEADER_CONSTANTS=a}),null);
__d("DGWExponentialBackoff",["Promise","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";f.callWithExponentialBackoff=a;var g={maxRetries:5,baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)},h=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.errors=c;return a}return a}(babelHelpers.wrapNativeSuper(Error));function a(a,c){return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:c===void 0&&(c=g);d.prev=1;d.next=4;return b("regeneratorRuntime").awrap(i(a,c));case 4:return d.abrupt("return",d.sent);case 7:d.prev=7;d.t0=d["catch"](1);throw d.t0.errors[d.t0.errors.length-1];case 10:case"end":return d.stop()}},null,this,[[1,7]])}function i(a,c){var d,e,f,g,i;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:d=0,e=[],f=c.baseRetryInterval,g=c.backoffFactor;case 4:if(!(d<=c.maxRetries)){k.next=20;break}k.prev=5;k.next=8;return b("regeneratorRuntime").awrap(a());case 8:i=k.sent;return k.abrupt("return",i);case 12:k.prev=12,k.t0=k["catch"](5),e.push(k.t0);case 15:k.next=17;return b("regeneratorRuntime").awrap(j(f*Math.pow(g,d)));case 17:++d;k.next=4;break;case 20:throw new h("Max call count exceeded",e);case 21:case"end":return k.stop()}},null,this,[[5,12]])}function j(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(new(b("Promise"))(function(b){return setTimeout(b,a)}));case 2:case"end":return c.stop()}},null,this)}}),null);
__d("DGWStreamEvents",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c){this.$4=new Map(),this.$5=new Map(),this.$6=a,this.$1=b,c!=null&&(this.$8="streamId:"+c+"::")}var b=a.prototype;b.streamEstablished=function(){this.$6.logEvent(this.$1,"open",this.$8),this.$3=Date.now(),this.$6.bumpODSKey(this.$1,"stream_establishment_success")};b.streamEstablishmentPending=function(){this.$2=Date.now(),this.$6.logEvent(this.$1,"streamPending",this.$8),this.$6.bumpODSKey(this.$1,"stream_establishment_pending")};b.dataSent=function(a,b,c){var d=c?"sendWithAckRequested":"sendWithoutAckRequested";this.$6.logEvent(this.$1,d,((d=this.$8)!=null?d:"")+"sendId:"+a+", payloadSize:"+b);this.$4.set(a,{ackRequested:c,payloadSize:b,sendTimestamp:Date.now()})};b.ackReceived=function(a){var b;this.$6.logEvent(this.$1,"AckReceived",((b=this.$8)!=null?b:"")+"sendId:"+a+"}");this.$6.bumpODSKey(this.$1,"ack_received");b=this.$4.get(a);b!=null&&(b.ackReceivedTimestamp=Date.now())};b.ackSent=function(a){var b;this.$6.bumpODSKey(this.$1,"ack_sent");this.$6.logEvent(this.$1,"ACK sent",((b=this.$8)!=null?b:"")+"ackId: "+a)};b.drainSent=function(a){var b;this.$6.logEvent(this.$1,"Drain sent",((b=this.$8)!=null?b:"")+"drainReason: "+a)};b.dataReceived=function(a,b,c){var d;this.$6.bumpODSKey(this.$1,"data_received");this.$6.logEvent(this.$1,"Data received",((d=this.$8)!=null?d:"")+"sendId: "+((d=c)!=null?d:"null")+", ackRequested: "+b.toString()+", payloadSize: "+a);c!=null&&this.$5.set(c,{ackRequested:b,payloadSize:a,receiveTimestamp:Date.now()})};b.endOfDataReceived=function(){this.$6.bumpODSKey(this.$1,"end_of_data_received"),this.$6.logEvent(this.$1,"EndOfDataReceived",this.$8)};b.endOfDataSent=function(){this.$6.bumpODSKey(this.$1,"end_of_data_sent"),this.$6.logEvent(this.$1,"EndOfDataSent",this.$8)};b.streamClosed=function(a,b){this.$7=Date.now();var c=this.$9();if(a){this.$6.bumpODSKey(this.$1,"stream_closed_gracefully");this.$6.logEvent(this.$1,"Stream closed gracefully",""+((a=this.$8)!=null?a:"")+c)}else{this.$6.bumpODSKey(this.$1,"stream_closed_with_error");this.$6.logError(this.$1,"Stream closed abnormally",b,""+((a=this.$8)!=null?a:"")+c)}};b.connectionEstablishmentFailure=function(a){this.$6.logEvent(this.$1,"WebSocket connection establishment failure","WebSocket close code: "+a)};b.streamEstablishmentFailure=function(a,b){this.$6.logError(this.$1,"Failed to establish DGW Stream","Last seen error: "+a.toString(),""+((a=this.$8)!=null?a:"")+b);this.$6.bumpODSKey(this.$1,"stream_establishment_failure")};b.error=function(a,b){var c={};c.msg=b;c.state=this.$9();this.$6.logError(this.$1,a,JSON.stringify(c),this.$8)};b.$9=function(){var a={};a.currentNetworkCondition=window.navigator&&window.navigator.onLine==!0;a.establishRequestTimestamp=this.$2;a.establishedTimestamp=this.$3;a.streamClosedTimestamp=this.$7;a.sendHistory=JSON.stringify(Array.from(this.$4.entries()));a.receiveHistory=JSON.stringify(Array.from(this.$5.entries()));return JSON.stringify(a)};return a}();f.DGWStreamEvents=a}),null);
__d("DGWCppBridge",["Promise"],(function(h,i,j,k,l,m){var n=function(){var j=typeof document!=="undefined"&&document.currentScript?document.currentScript.src:void 0;return function(k){k=k||{};var k=typeof k!=="undefined"?k:{},o;k.ready=new(i("Promise"))(function(h,i){o=h,i});var p={},q;for(q in k)Object.prototype.hasOwnProperty.call(k,q)&&(p[q]=k[q]);var r=[];(function(h,i){throw i});var s=!0,t=!1,u="";function v(h){return k.locateFile?k.locateFile(h,u):u+h}var w;(s||t)&&(t?u=self.location.href:document.currentScript&&(u=document.currentScript.src),j&&(u=j),u.indexOf("blob:")!==0?u=u.substr(0,u.lastIndexOf("/")+1):u="",(function(h){try{var i=new XMLHttpRequest();i.open("GET",h,!1);i.send(null);return i.responseText}catch(j){i=ba(h);if(i)return va(i);throw j}},t&&(w=function(h){try{var i=new XMLHttpRequest();i.open("GET",h,!1);i.responseType="arraybuffer";i.send(null);return new Uint8Array(i.response)}catch(j){i=ba(h);if(i)return i;throw j}}),function(h,i,j){var k=new XMLHttpRequest();k.open("GET",h,!0);k.responseType="arraybuffer";k.onload=function(){if(k.status==200||k.status==0&&k.response){i(k.response);return}var l=ba(h);if(l){i(l.buffer);return}j()};k.onerror=j;k.send(null)}),function(h){document.title=h});var x=k.print||emptyFunction.bind(console),y=k.printErr||emptyFunction.bind(console);for(q in p)Object.prototype.hasOwnProperty.call(p,q)&&(k[q]=p[q]);p=null;k.arguments&&(r=k.arguments);k.thisProgram&&k.thisProgram;k.quit&&k.quit;var z;k.wasmBinary&&(z=k.wasmBinary);k.noExitRuntime&&k.noExitRuntime;var A={Memory:function(h){return{buffer:new ArrayBuffer(h.initial*65536),grow:function(h){h=ea(h);return h}}},Table:function(h){var i=new Array(h.initial);i.grow=function(h){i.length>=1+0&&U("Unable to grow wasm table. Use a higher value for RESERVED_FUNCTION_POINTERS or set ALLOW_TABLE_GROWTH."),i.push(null)};i.set=function(h,j){i[h]=j};i.get=function(h){return i[h]};return i},Module:function(h){return{}},Instance:function(i,j){i=function(k,i,j){function j(i,k,j){var l=k.memory,m=new i.Int8Array(j);new i.Int16Array(j);var n=new i.Int32Array(j),o=new i.Uint8Array(j);new i.Uint16Array(j);var p=new i.Uint32Array(j);new i.Float32Array(j);new i.Float64Array(j);var q=i.Math.imul;i.Math.fround;i.Math.abs;var r=i.Math.clz32;i.Math.min;i.Math.max;i.Math.floor;i.Math.ceil;i.Math.sqrt;k.abort;i.NaN;i.Infinity;var s=k.emscripten_memcpy_big,t=k.emscripten_resize_heap,u=5245120,v=0;function w(h,i,j,k,l,r){var s=0,t=0;s=u-80|0;u=s;n[s+72>>2]=h;n[s+68>>2]=i;n[s+64>>2]=j;n[s+60>>2]=k;n[s+56>>2]=l;n[s+52>>2]=r;a:{b:{c:{if(!n[s+72>>2]|!n[s+68>>2]|(!n[s+64>>2]|!n[s+60>>2]))break c;if(!n[s+56>>2])break c;if(n[s+52>>2])break b}n[s+76>>2]=5;break a}n[n[s+64>>2]>>2]=0;n[n[s+60>>2]>>2]=0;t=s,j=z(n[s+72>>2],n[s+68>>2],n[s+56>>2],n[s+52>>2]),n[t+48>>2]=j;if(!n[s+48>>2]){n[s+76>>2]=0;break a}t=s,j=y(q(n[s+48>>2],20)),n[t+44>>2]=j;if(!n[s+44>>2]){n[s+76>>2]=3;break a}n[s+40>>2]=n[s+44>>2];n[s+36>>2]=n[s+72>>2];n[s+32>>2]=n[s+68>>2]-n[n[s+52>>2]>>2];n[s+28>>2]=0;while(1){if(p[s+28>>2]<p[s+48>>2]){if(p[s+32>>2]<1){M(n[s+44>>2],n[s+28>>2]);n[s+76>>2]=1;break a}m[s+27|0]=o[n[s+36>>2]];n[s+36>>2]=n[s+36>>2]+1;n[s+32>>2]=n[s+32>>2]-1;d:{if(!o[s+27|0]|o[s+27|0]==1|(o[s+27|0]==2|o[s+27|0]==3))break d;if(o[s+27|0]==4|o[s+27|0]==9|o[s+27|0]==10)break d;if(Q(o[s+27|0])&1)break d;M(n[s+44>>2],n[s+28>>2]);n[s+76>>2]=6;break a}h=n[s+40>>2];n[h>>2]=o[s+27|0]&15|n[h>>2]&-16;e:{f:{if(!(o[s+27|0]==2|o[s+27|0]==4|o[s+27|0]==9)&&o[s+27|0]!=10)break f;h=n[s+40>>2];n[h>>2]=n[h>>2]&-268435441;n[s+40>>2]=n[s+40>>2]+20;break e}if(Q(o[s+27|0])&1){t=s,j=x(n[s+40>>2],s+36|0,s+32|0),n[t+20>>2]=j;if(!n[s+20>>2]){n[s+40>>2]=n[s+40>>2]+20;break e}M(n[s+44>>2],n[s+28>>2]);n[s+76>>2]=n[s+20>>2];break a}n[s+16>>2]=0;if(p[s+32>>2]<3){M(n[s+44>>2],n[s+28>>2]);n[s+76>>2]=1;break a}h=n[s+36>>2];i=o[h|0]|o[h+1|0]<<8;m[s+16|0]=i;m[s+17|0]=i>>>8;m[s+18|0]=o[h+2|0];n[s+36>>2]=n[s+36>>2]+3;n[s+32>>2]=n[s+32>>2]-3;if(!(n[s+16>>2]==1|o[s+27|0]!=1)){M(n[s+44>>2],n[s+28>>2]);n[s+76>>2]=7;break a}h=n[s+40>>2];n[h>>2]=n[h>>2]&-268435441|(n[s+16>>2]&16777215)<<4;if(o[s+27|0]==3){if(n[s+16>>2]!=1){M(n[s+44>>2],n[s+28>>2]);n[s+76>>2]=10;break a}m[s+15|0]=0;if(p[s+32>>2]<1){H(n[s+44>>2]);n[s+76>>2]=1;break a}m[s+15|0]=o[n[s+36>>2]];n[s+36>>2]=n[s+36>>2]+1;n[s+32>>2]=n[s+32>>2]-1;g:{if(o[s+15|0]<=4){m[n[s+40>>2]+4|0]=o[s+15|0];break g}m[n[s+40>>2]+4|0]=4}n[s+40>>2]=n[s+40>>2]+20;break e}t=s,j=O(s+36|0,s+32|0,s+14|0,s+13|0),n[t+8>>2]=j;if(n[s+8>>2]){M(n[s+44>>2],n[s+28>>2]);n[s+76>>2]=n[s+8>>2];break a}if(o[s+27|0]==1){h=n[s+40>>2];m[h+4|0]=m[h+4|0]&1|o[s+13|0]<<1;n[s+40>>2]=n[s+40>>2]+20;break e}if(!o[s+27|0]){t=s,j=K(s+36|0,s+32|0,n[s+16>>2],n[s+40>>2]+8|0,n[s+40>>2]+12|0),n[t+4>>2]=j;if(n[s+4>>2]){M(n[s+44>>2],n[s+28>>2]);n[s+76>>2]=n[s+4>>2];break a}h=n[s+40>>2];m[h+4|0]=m[s+14|0]&1|o[h+4|0]&254;h=n[s+40>>2];m[h+4|0]=m[h+4|0]&1|o[s+13|0]<<1;n[s+40>>2]=n[s+40>>2]+20}}n[s+28>>2]=n[s+28>>2]+1;continue}break}if(n[s+32>>2]){M(n[s+44>>2],n[s+48>>2]);n[s+76>>2]=1;break a}n[n[s+64>>2]>>2]=n[s+44>>2];n[n[s+60>>2]>>2]=n[s+48>>2];n[s+76>>2]=0}u=s+80|0;return n[s+76>>2]}function x(h,i,j){var k=0,l=0;k=u-32|0;u=k;n[k+24>>2]=h;n[k+20>>2]=i;n[k+16>>2]=j;a:{if(!(Q(n[n[k+24>>2]>>2]&15)&1)){n[k+28>>2]=1;break a}if(p[n[k+16>>2]>>2]<1){n[k+28>>2]=1;break a}m[n[k+24>>2]+4|0]=o[n[n[k+20>>2]>>2]];h=n[k+20>>2];n[h>>2]=n[h>>2]+1;h=n[k+16>>2];n[h>>2]=n[h>>2]-1;if((n[n[k+24>>2]>>2]&15)==8){h=n[k+24>>2];n[h>>2]=n[h>>2]&-268435441;n[k+28>>2]=0;break a}if(p[n[k+16>>2]>>2]<3){n[k+28>>2]=11;break a}n[k+12>>2]=0;h=n[n[k+20>>2]>>2];i=o[h|0]|o[h+1|0]<<8;m[k+12|0]=i;m[k+13|0]=i>>>8;m[k+14|0]=o[h+2|0];h=n[k+20>>2];n[h>>2]=n[h>>2]+3;h=n[k+16>>2];n[h>>2]=n[h>>2]-3;h=n[k+24>>2];n[h>>2]=n[h>>2]&-268435441|(n[k+12>>2]&16777215)<<4;if(p[n[k+16>>2]>>2]<p[k+12>>2]){n[k+28>>2]=11;break a}if((n[n[k+24>>2]>>2]&15)==5){n[n[k+24>>2]+12>>2]=n[k+12>>2];h=y(n[k+12>>2]);n[n[k+24>>2]+8>>2]=h;if(!n[n[k+24>>2]+8>>2]){n[k+28>>2]=3;break a}A(n[n[k+24>>2]+8>>2],n[n[k+20>>2]>>2],n[k+12>>2]);h=n[k+20>>2];n[h>>2]=n[k+12>>2]+n[h>>2];h=n[k+16>>2];n[h>>2]=n[h>>2]-n[k+12>>2];n[k+28>>2]=0;break a}l=k,j=O(n[k+20>>2],n[k+16>>2],k+11|0,k+10|0),n[l+4>>2]=j;if(n[k+4>>2]){n[k+28>>2]=n[k+4>>2];break a}if((n[n[k+24>>2]>>2]&15)==7){h=n[k+24>>2];m[h+8|0]=m[h+8|0]&1|o[k+10|0]<<1;n[k+28>>2]=0;break a}if((n[n[k+24>>2]>>2]&15)==6){l=k,j=K(n[k+20>>2],n[k+16>>2],n[k+12>>2],n[k+24>>2]+12|0,n[k+24>>2]+16|0),n[l>>2]=j;if(n[k>>2]){n[k+28>>2]=n[k>>2];break a}h=n[k+24>>2];m[h+8|0]=m[k+11|0]&1|o[h+8|0]&254;h=n[k+24>>2];m[h+8|0]=m[h+8|0]&1|o[k+10|0]<<1;n[k+28>>2]=0;break a}n[k+28>>2]=1}u=k+32|0;return n[k+28>>2]}function y(l){var m=0,h,o=0,i=0,p=0,j=0,q=0,s=0,k=0,t;q=8;a:{b:{while(1){if(q+-1&q)break b;q=q>>>0>8?q:8;o=n[515];j=o;p=n[514];s=p;l=l>>>0>8?l+3&-4:8;c:{if(l>>>0<=127){i=(l>>>3|0)+-1|0;break c}m=r(l);i=((l>>>29-m^4)-(m<<2)|0)+110|0;if(l>>>0<=4095)break c;m=((l>>>30-m^2)-(m<<1)|0)+71|0;i=m>>>0<63?m:63}m=i;h=m&31;32<=(m&63)>>>0?(m=0,h=o>>>h|0):(m=o>>>h|0,h=((1<<h)-1&o)<<32-h|s>>>h);o=m;if(m|h){while(1){j=h;p=la(h,o);m=p;h=m&31;32<=(m&63)>>>0?(m=0,j=o>>>h|0):(m=o>>>h|0,j=((1<<h)-1&o)<<32-h|j>>>h);o=m;i=i+p|0;p=i<<4;m=n[p+1032>>2];s=p+1024|0;d:{if((m|0)!=(s|0)){h=E(m,q,l);if(h)break a;h=n[m+4>>2];n[h+8>>2]=n[m+8>>2];n[n[m+8>>2]+4>>2]=h;n[m+8>>2]=s;h=p+1028|0;n[m+4>>2]=n[h>>2];n[h>>2]=m;n[n[m+4>>2]+8>>2]=m;i=i+1|0;h=(o&1)<<31|j>>>1;o=o>>>1|0;break d}m=n[515];k=2056,t=n[514]&L(i),n[k>>2]=t;n[515]=v&m;h=j^1}if(h|o)continue;break}p=n[514];j=n[515]}o=r(j);o=63-((o|0)==32?r(p)+32|0:o)<<4;m=o+1024|0;o=n[o+1032>>2];e:{if(!j&p>>>0<1073741824|j>>>0<0)break e;i=99;if((m|0)==(o|0))break e;while(1){if(!i)break e;h=E(o,q,l);if(h)break a;i=i+-1|0;o=n[o+8>>2];if((m|0)!=(o|0))continue;break}o=m}if(D(l+48|0))continue;break}if((m|0)==(o|0))break b;while(1){h=E(o,q,l);if(h)break a;o=n[o+8>>2];if((m|0)!=(o|0))continue;break}}h=0}return h}function z(h,i,j,k){var l=0;l=u-48|0;u=l;n[l+40>>2]=h;n[l+36>>2]=i;n[l+32>>2]=j;n[l+28>>2]=k;n[l+24>>2]=0;n[l+20>>2]=n[l+40>>2];a:{b:{c:{while(1){if(p[l+36>>2]<=0)break b;n[l+16>>2]=n[l+20>>2];m[l+15|0]=o[n[l+20>>2]];n[l+36>>2]=n[l+36>>2]-1;n[l+20>>2]=n[l+20>>2]+1;d:{if(!(o[l+15|0]==2|o[l+15|0]==4|o[l+15|0]==9)&&o[l+15|0]!=10)break d;n[l+24>>2]=n[l+24>>2]+1;continue}n[l+8>>2]=1;if(Q(o[l+15|0])&1){if(p[l+36>>2]<1){n[n[l+32>>2]>>2]=n[l+16>>2];n[n[l+28>>2]>>2]=n[l+36>>2]+n[l+8>>2];break a}n[l+36>>2]=n[l+36>>2]-1;n[l+8>>2]=n[l+8>>2]+1;n[l+20>>2]=n[l+20>>2]+1;if(o[l+15|0]==8){n[l+24>>2]=n[l+24>>2]+1;continue}}if(p[l+36>>2]<3)break c;n[l+4>>2]=0;h=l+4|0;i=n[l+20>>2];j=o[i|0]|o[i+1|0]<<8;m[h|0]=j;m[h+1|0]=j>>>8;m[h+2|0]=o[i+2|0];n[l+36>>2]=n[l+36>>2]-3;n[l+8>>2]=n[l+8>>2]+3;n[l+20>>2]=n[l+20>>2]+3;if(p[l+4>>2]<=p[l+36>>2]){n[l+24>>2]=n[l+24>>2]+1;n[l+20>>2]=n[l+4>>2]+n[l+20>>2];n[l+36>>2]=n[l+36>>2]-n[l+4>>2];continue}break}n[n[l+32>>2]>>2]=n[l+16>>2];n[n[l+28>>2]>>2]=n[l+36>>2]+n[l+8>>2];break a}n[n[l+32>>2]>>2]=n[l+16>>2];n[n[l+28>>2]>>2]=n[l+36>>2]+n[l+8>>2];break a}n[n[l+28>>2]>>2]=n[l+36>>2]}n[l+44>>2]=n[l+24>>2];u=l+48|0;return n[l+44>>2]}function A(i,j,k){var l,h;if(k>>>0>=512){s(i|0,j|0,k|0)|0;return}l=i+k|0;a:{if(!((i^j)&3)){b:{if((k|0)<1){k=i;break b}if(!(i&3)){k=i;break b}k=i;while(1){m[k|0]=o[j|0];j=j+1|0;k=k+1|0;if(k>>>0>=l>>>0)break b;if(k&3)continue;break}}i=l&-4;c:{if(i>>>0<64)break c;h=i+-64|0;if(k>>>0>h>>>0)break c;while(1){n[k>>2]=n[j>>2];n[k+4>>2]=n[j+4>>2];n[k+8>>2]=n[j+8>>2];n[k+12>>2]=n[j+12>>2];n[k+16>>2]=n[j+16>>2];n[k+20>>2]=n[j+20>>2];n[k+24>>2]=n[j+24>>2];n[k+28>>2]=n[j+28>>2];n[k+32>>2]=n[j+32>>2];n[k+36>>2]=n[j+36>>2];n[k+40>>2]=n[j+40>>2];n[k+44>>2]=n[j+44>>2];n[k+48>>2]=n[j+48>>2];n[k+52>>2]=n[j+52>>2];n[k+56>>2]=n[j+56>>2];n[k+60>>2]=n[j+60>>2];j=j- -64|0;k=k- -64|0;if(k>>>0<=h>>>0)continue;break}}if(k>>>0>=i>>>0)break a;while(1){n[k>>2]=n[j>>2];j=j+4|0;k=k+4|0;if(k>>>0<i>>>0)continue;break}break a}if(l>>>0<4){k=i;break a}h=l+-4|0;if(h>>>0<i>>>0){k=i;break a}k=i;while(1){m[k|0]=o[j|0];m[k+1|0]=o[j+1|0];m[k+2|0]=o[j+2|0];m[k+3|0]=o[j+3|0];j=j+4|0;k=k+4|0;if(k>>>0<=h>>>0)continue;break}}if(k>>>0<l>>>0)while(1){m[k|0]=o[j|0];j=j+1|0;k=k+1|0;if((l|0)!=(k|0))continue;break}}function B(i,j,k,l,q,r,h){var s=0,t=0;s=u+-64|0;u=s;m[s+59|0]=i;n[s+52>>2]=j;n[s+48>>2]=k;m[s+47|0]=l;m[s+46|0]=q;n[s+40>>2]=r;n[s+36>>2]=h;a:{if(!(!(m[s+47|0]&1)|o[s+46|0]<=127)){n[s+60>>2]=4;break a}b:{if(!(!n[s+52>>2]|(!n[s+40>>2]|!n[s+36>>2]))&&p[s+48>>2]<=16777215)break b;n[s+60>>2]=5;break a}n[s+32>>2]=n[s+48>>2]+6;t=s,k=y(n[s+32>>2]),n[t+28>>2]=k;if(!n[s+28>>2]){n[s+60>>2]=3;break a}n[s+24>>2]=n[s+28>>2];m[s+23|0]=6;m[n[s+24>>2]]=o[s+23|0];n[s+24>>2]=n[s+24>>2]+1;m[n[s+24>>2]]=o[s+59|0];n[s+24>>2]=n[s+24>>2]+1;n[s+16>>2]=n[s+48>>2]+1;if(p[s+16>>2]<p[s+48>>2]){H(n[s+28>>2]);n[s+60>>2]=9;break a}i=n[s+24>>2];j=o[s+16|0]|o[s+17|0]<<8;m[i|0]=j;m[i+1|0]=j>>>8;m[i+2|0]=o[s+18|0];n[s+24>>2]=n[s+24>>2]+3;m[s+15|0]=o[s+46|0];m[s+47|0]&1&&(m[s+15|0]=o[s+15|0]|128);m[n[s+24>>2]]=o[s+15|0];n[s+24>>2]=n[s+24>>2]+1;A(n[s+24>>2],n[s+52>>2],n[s+48>>2]);n[n[s+40>>2]>>2]=n[s+28>>2];n[n[s+36>>2]>>2]=n[s+32>>2];n[s+60>>2]=0}u=s- -64|0;return n[s+60>>2]}function C(i,j,k,l,q,r){var h=0,s=0;h=u-48|0;u=h;n[h+40>>2]=i;n[h+36>>2]=j;m[h+35|0]=k;m[h+34|0]=l;n[h+28>>2]=q;n[h+24>>2]=r;a:{if(!(!(m[h+35|0]&1)|o[h+34|0]<=127)){n[h+44>>2]=4;break a}b:{if(!(!n[h+40>>2]|(!n[h+28>>2]|!n[h+24>>2]))&&p[h+36>>2]<=16777215)break b;n[h+44>>2]=5;break a}n[h+20>>2]=n[h+36>>2]+5;s=h,k=y(n[h+20>>2]),n[s+16>>2]=k;if(!n[h+16>>2]){n[h+44>>2]=3;break a}n[h+12>>2]=n[h+16>>2];m[h+11|0]=0;m[n[h+12>>2]]=o[h+11|0];n[h+12>>2]=n[h+12>>2]+1;n[h+4>>2]=n[h+36>>2]+1;if(p[h+4>>2]<p[h+36>>2]){H(n[h+16>>2]);n[h+44>>2]=9;break a}i=n[h+12>>2];j=o[h+4|0]|o[h+5|0]<<8;m[i|0]=j;m[i+1|0]=j>>>8;m[i+2|0]=o[h+6|0];n[h+12>>2]=n[h+12>>2]+3;m[h+3|0]=o[h+34|0];m[h+35|0]&1&&(m[h+3|0]=o[h+3|0]|128);m[n[h+12>>2]]=o[h+3|0];n[h+12>>2]=n[h+12>>2]+1;A(n[h+12>>2],n[h+40>>2],n[h+36>>2]);n[n[h+28>>2]>>2]=n[h+16>>2];n[n[h+24>>2]>>2]=n[h+20>>2];n[h+44>>2]=0}u=h+48|0;return n[h+44>>2]}function D(k){var l,h=0,m,i,o=0,j;l=ma(k);if((l|0)>=1){h=16;i=k+l|0;m=i+-16|0;n[m+12>>2]=16;n[m>>2]=16;k=n[512];a:{b:{if(!(!k|(l|0)!=n[k+8>>2])){h=n[l+-4>>2];o=l-(h>>31^h)|0;j=n[o+-4>>2];n[k+8>>2]=i;h=-16;k=o-(j>>31^j)|0;if(n[(k+n[k>>2]|0)+-4>>2]>-1)break b;l=n[k+4>>2];n[l+8>>2]=n[k+8>>2];n[n[k+8>>2]+4>>2]=l;l=m-k|0;n[k>>2]=l;break a}n[l+12>>2]=16;n[l>>2]=16;n[l+8>>2]=i;n[l+4>>2]=k;n[512]=l}k=l+h|0;l=m-k|0;n[k>>2]=l}n[((l&-4)+k|0)+-4>>2]=l^-1;o=k;h=n[k>>2]+-8|0;c:{if(h>>>0<=127){l=(h>>>3|0)+-1|0;break c}i=r(h);l=((h>>>29-i^4)-(i<<2)|0)+110|0;if(h>>>0<=4095)break c;l=((h>>>30-i^2)-(i<<1)|0)+71|0;l=l>>>0<63?l:63}m=l<<4;n[o+4>>2]=m+1024;m=m+1032|0;n[k+8>>2]=n[m>>2];n[m>>2]=k;n[n[k+8>>2]+4>>2]=k;m=n[515];k=l&31;32<=(l&63)>>>0?(l=1<<k,k=0):(l=(1<<k)-1&1>>>32-k,k=1<<k);n[514]=k|n[514];n[515]=l|m;k=1}else k=0;return k}function E(k,l,h){var m,i=0,o=0,j=0;i=k+4|0;m=(i+l|0)+-1&0-l;l=n[k>>2];if(m+h>>>0<=(l+k|0)+-4>>>0){o=n[k+4>>2];n[o+8>>2]=n[k+8>>2];n[n[k+8>>2]+4>>2]=o;(i|0)!=(m|0)&&(m=m-i|0,o=n[k+-4>>2],o=k-(o>>31^o)|0,i=m+n[o>>2]|0,n[o>>2]=i,n[(o+(i&-4)|0)+-4>>2]=i,k=k+m|0,l=l-m|0,n[k>>2]=l);a:{if(h+24>>>0<=l>>>0){i=(k+h|0)+8|0;l=l-h|0;m=l+-8|0;n[i>>2]=m;n[(i+(m&-4)|0)+-4>>2]=7-l;j=i;o=n[i>>2]+-8|0;b:{if(o>>>0<=127){m=(o>>>3|0)+-1|0;break b}l=r(o);m=((o>>>29-l^4)-(l<<2)|0)+110|0;if(o>>>0<=4095)break b;l=((o>>>30-l^2)-(l<<1)|0)+71|0;m=l>>>0<63?l:63}l=m;m=l<<4;n[j+4>>2]=m+1024;m=m+1032|0;n[i+8>>2]=n[m>>2];n[m>>2]=i;n[n[i+8>>2]+4>>2]=i;m=n[515];i=l&31;32<=(l&63)>>>0?(l=1<<i,j=0):(l=(1<<i)-1&1>>>32-i,j=1<<i);n[514]=j|n[514];n[515]=l|m;l=h+8|0;n[k>>2]=l;n[((l&-4)+k|0)+-4>>2]=l;break a}n[(k+l|0)+-4>>2]=l}k=k+4|0}else k=0;return k}function F(i,j,k,l,q){var r=0,h=0;r=u-48|0;u=r;m[r+43|0]=i;n[r+36>>2]=j;n[r+32>>2]=k;n[r+28>>2]=l;n[r+24>>2]=q;a:{if(!(n[r+24>>2]?n[r+28>>2]:0)){n[r+44>>2]=5;break a}n[n[r+28>>2]>>2]=0;n[n[r+24>>2]>>2]=0;if(!(p[r+32>>2]<=16777215?n[r+36>>2]:0)){n[r+44>>2]=5;break a}n[r+20>>2]=n[r+32>>2]+5;h=r,k=y(n[r+20>>2]),n[h+16>>2]=k;if(!n[r+16>>2]){n[r+44>>2]=3;break a}n[r+12>>2]=n[r+16>>2];m[r+11|0]=5;m[n[r+12>>2]]=o[r+11|0];n[r+12>>2]=n[r+12>>2]+1;m[n[r+12>>2]]=o[r+43|0];n[r+12>>2]=n[r+12>>2]+1;i=n[r+12>>2];j=o[r+32|0]|o[r+33|0]<<8;m[i|0]=j;m[i+1|0]=j>>>8;m[i+2|0]=o[r+34|0];n[r+12>>2]=n[r+12>>2]+3;A(n[r+12>>2],n[r+36>>2],n[r+32>>2]);n[r+12>>2]=n[r+32>>2]+n[r+12>>2];n[n[r+28>>2]>>2]=n[r+16>>2];n[n[r+24>>2]>>2]=n[r+20>>2];n[r+44>>2]=0}u=r+48|0;return n[r+44>>2]}function H(j){var k=0,h,l=0,i,m=0;if(j){h=j+-4|0;i=n[h>>2];l=i;k=h;m=n[j+-8>>2];(m|0)<=-1&&(j=h+m|0,k=n[j+5>>2],n[k+8>>2]=n[j+9>>2],n[n[j+9>>2]+4>>2]=k,l=i+(m^-1)|0,k=j+1|0);j=h+i|0;h=n[j>>2];(h|0)!=n[(j+h|0)+-4>>2]&&(i=n[j+4>>2],n[i+8>>2]=n[j+8>>2],n[n[j+8>>2]+4>>2]=i,l=h+l|0);n[k>>2]=l;n[((l&-4)+k|0)+-4>>2]=l^-1;m=k;l=n[k>>2]+-8|0;a:{if(l>>>0<=127){j=(l>>>3|0)+-1|0;break a}i=r(l);j=((l>>>29-i^4)-(i<<2)|0)+110|0;if(l>>>0<=4095)break a;j=((l>>>30-i^2)-(i<<1)|0)+71|0;j=j>>>0<63?j:63}h=j<<4;n[m+4>>2]=h+1024;h=h+1032|0;n[k+8>>2]=n[h>>2];n[h>>2]=k;n[n[k+8>>2]+4>>2]=k;h=n[515];k=j&31;32<=(j&63)>>>0?(j=1<<k,k=0):(j=(1<<k)-1&1>>>32-k,k=1<<k);n[514]=k|n[514];n[515]=j|h}}function I(i,j,k,l){var h=0,p=0;h=u-48|0;u=h;m[h+43|0]=i;m[h+42|0]=j;n[h+36>>2]=k;n[h+32>>2]=l;a:{if(o[h+42|0]>127){n[h+44>>2]=4;break a}if(!(n[h+32>>2]?n[h+36>>2]:0)){n[h+44>>2]=5;break a}n[h+28>>2]=6;p=h,k=y(n[h+28>>2]),n[p+24>>2]=k;if(!n[h+24>>2]){n[h+44>>2]=3;break a}n[h+20>>2]=n[h+24>>2];m[h+19|0]=7;m[n[h+20>>2]]=o[h+19|0];n[h+20>>2]=n[h+20>>2]+1;m[n[h+20>>2]]=o[h+43|0];n[h+20>>2]=n[h+20>>2]+1;n[h+12>>2]=1;i=n[h+20>>2];j=o[h+12|0]|o[h+13|0]<<8;m[i|0]=j;m[i+1|0]=j>>>8;m[i+2|0]=o[h+14|0];n[h+20>>2]=n[h+20>>2]+3;m[n[h+20>>2]]=o[h+42|0];n[n[h+36>>2]>>2]=n[h+24>>2];n[n[h+32>>2]>>2]=n[h+28>>2];n[h+44>>2]=0}u=h+48|0;return n[h+44>>2]}function J(h,i,j){var k=0,l=0;k=u-48|0;u=k;n[k+40>>2]=h;n[k+36>>2]=i;n[k+32>>2]=j;a:{if(!(n[k+32>>2]?n[k+36>>2]:0)){n[k+44>>2]=5;break a}if(p[k+40>>2]>4){n[k+44>>2]=8;break a}n[k+28>>2]=5;l=k,j=y(n[k+28>>2]),n[l+24>>2]=j;if(!n[k+24>>2]){n[k+44>>2]=3;break a}n[k+20>>2]=n[k+24>>2];m[k+19|0]=3;m[n[k+20>>2]]=o[k+19|0];n[k+20>>2]=n[k+20>>2]+1;n[k+12>>2]=1;h=n[k+20>>2];i=o[k+12|0]|o[k+13|0]<<8;m[h|0]=i;m[h+1|0]=i>>>8;m[h+2|0]=o[k+14|0];n[k+20>>2]=n[k+20>>2]+3;m[k+11|0]=n[k+40>>2];m[n[k+20>>2]]=o[k+11|0];n[n[k+36>>2]>>2]=n[k+24>>2];n[n[k+32>>2]>>2]=n[k+28>>2];n[k+44>>2]=0}u=k+48|0;return n[k+44>>2]}function ha(i,j,k){var l=0,h=0;l=u-48|0;u=l;m[l+43|0]=i;n[l+36>>2]=j;n[l+32>>2]=k;a:{if(o[l+43|0]>127){n[l+44>>2]=4;break a}if(!(n[l+32>>2]?n[l+36>>2]:0)){n[l+44>>2]=5;break a}n[l+28>>2]=5;h=l,k=y(n[l+28>>2]),n[h+24>>2]=k;if(!n[l+24>>2]){n[l+44>>2]=3;break a}n[l+20>>2]=n[l+24>>2];m[l+19|0]=1;m[n[l+20>>2]]=o[l+19|0];n[l+20>>2]=n[l+20>>2]+1;n[l+12>>2]=1;i=n[l+20>>2];j=o[l+12|0]|o[l+13|0]<<8;m[i|0]=j;m[i+1|0]=j>>>8;m[i+2|0]=o[l+14|0];n[l+20>>2]=n[l+20>>2]+3;m[n[l+20>>2]]=o[l+43|0];n[n[l+36>>2]>>2]=n[l+24>>2];n[n[l+32>>2]>>2]=n[l+28>>2];n[l+44>>2]=0}u=l+48|0;return n[l+44>>2]}function K(j,k,h,l,i){var m=0;m=u-32|0;u=m;n[m+24>>2]=j;n[m+20>>2]=k;n[m+16>>2]=h;n[m+12>>2]=l;n[m+8>>2]=i;a:{if(p[m+16>>2]<1){n[m+28>>2]=9;break a}n[n[m+8>>2]>>2]=n[m+16>>2]-1;if(p[n[m+20>>2]>>2]<p[n[m+8>>2]>>2]){n[m+28>>2]=1;break a}j=y(n[n[m+8>>2]>>2]);n[n[m+12>>2]>>2]=j;if(!n[n[m+12>>2]>>2]){n[m+28>>2]=3;break a}A(n[n[m+12>>2]>>2],n[n[m+24>>2]>>2],n[n[m+8>>2]>>2]);j=n[m+24>>2];n[j>>2]=n[n[m+8>>2]>>2]+n[j>>2];j=n[m+20>>2];n[j>>2]=n[j>>2]-n[n[m+8>>2]>>2];n[m+28>>2]=0}u=m+32|0;return n[m+28>>2]}function L(k){var l,h,m,i,j,n;m=k&63;l=m;h=l&31;32<=l>>>0?(l=0,j=-1>>>h|0):(l=-1>>>h|0,j=(1<<h)-1<<32-h|-1>>>h);h=j&-2;i=m&31;32<=m>>>0?(l=h<<i,j=0):(l=(1<<i)-1&h>>>32-i|l<<i,j=h<<i);h=l;n=0-k&63;l=n;k=l&31;32<=l>>>0?(l=-1<<k,k=0):(l=(1<<k)-1&-1>>>32-k|-1<<k,k=-1<<k);i=k&-2;m=n&31;32<=n>>>0?(k=0,l=l>>>m|0):(k=l>>>m|0,l=((1<<m)-1&l)<<32-m|i>>>m);l=l|j;v=k|h;return l}function M(i,j){var h=0;h=u-16|0;u=h;n[h+12>>2]=i;n[h+8>>2]=j;n[h+4>>2]=0;while(1){if(p[h+4>>2]<p[h+8>>2]){n[h>>2]=n[h+12>>2]+q(n[h+4>>2],20);a:{if(!(n[n[h>>2]>>2]&15)){H(n[n[h>>2]+8>>2]);break a}b:{if((n[n[h>>2]>>2]&15)==5){H(n[n[h>>2]+8>>2]);break b}(n[n[h>>2]>>2]&15)==6&&H(n[n[h>>2]+12>>2])}}n[h+4>>2]=n[h+4>>2]+1;continue}break}H(n[h+12>>2]);u=h+16|0}function N(i,j,k){var l=0,h=0;l=u-32|0;u=l;m[l+27|0]=i;n[l+20>>2]=j;n[l+16>>2]=k;n[n[l+16>>2]>>2]=2;h=l,i=y(n[n[l+16>>2]>>2]),n[h+12>>2]=i;a:{if(!n[l+12>>2]){n[l+28>>2]=3;break a}n[n[l+20>>2]>>2]=n[l+12>>2];m[l+11|0]=8;m[n[l+12>>2]]=o[l+11|0];n[l+12>>2]=n[l+12>>2]+1;m[n[l+12>>2]]=o[l+27|0];n[l+28>>2]=0}u=l+32|0;return n[l+28>>2]}function O(h,i,j,k){var l;l=u-32|0;n[l+24>>2]=h;n[l+20>>2]=i;n[l+16>>2]=j;n[l+12>>2]=k;m[l+11|0]=0;a:{if(p[n[l+20>>2]>>2]<1){n[l+28>>2]=1;break a}m[l+11|0]=o[n[n[l+24>>2]>>2]];h=n[l+24>>2];n[h>>2]=n[h>>2]+1;h=n[l+20>>2];n[h>>2]=n[h>>2]-1;m[n[l+16>>2]]=(o[l+11|0]&128)==128;m[n[l+12>>2]]=o[l+11|0]&127;n[l+28>>2]=0}return n[l+28>>2]}function P(h,i){var j=0,k=0;j=u-32|0;u=j;n[j+24>>2]=h;n[j+20>>2]=i;k=j,h=y(1),n[k+16>>2]=h;a:{if(!n[j+16>>2]){n[j+28>>2]=3;break a}m[j+15|0]=10;m[n[j+16>>2]]=o[j+15|0];n[n[j+24>>2]>>2]=n[j+16>>2];n[n[j+20>>2]>>2]=1;n[j+28>>2]=0}u=j+32|0;return n[j+28>>2]}function ia(h,i){var j=0,k=0;j=u-32|0;u=j;n[j+24>>2]=h;n[j+20>>2]=i;k=j,h=y(1),n[k+16>>2]=h;a:{if(!n[j+16>>2]){n[j+28>>2]=3;break a}m[j+15|0]=2;m[n[j+16>>2]]=o[j+15|0];n[n[j+24>>2]>>2]=n[j+16>>2];n[n[j+20>>2]>>2]=1;n[j+28>>2]=0}u=j+32|0;return n[j+28>>2]}function ja(h,i){var j=0,k=0;j=u-32|0;u=j;n[j+24>>2]=h;n[j+20>>2]=i;k=j,h=y(1),n[k+16>>2]=h;a:{if(!n[j+16>>2]){n[j+28>>2]=3;break a}m[j+15|0]=4;m[n[j+16>>2]]=o[j+15|0];n[n[j+24>>2]>>2]=n[j+16>>2];n[n[j+20>>2]>>2]=1;n[j+28>>2]=0}u=j+32|0;return n[j+28>>2]}function ka(h,i){var j=0,k=0;j=u-32|0;u=j;n[j+24>>2]=h;n[j+20>>2]=i;k=j,h=y(1),n[k+16>>2]=h;a:{if(!n[j+16>>2]){n[j+28>>2]=3;break a}m[j+15|0]=9;m[n[j+16>>2]]=o[j+15|0];n[n[j+24>>2]>>2]=n[j+16>>2];n[n[j+20>>2]>>2]=1;n[j+28>>2]=0}u=j+32|0;return n[j+28>>2]}function la(i,j){var h=0,k=0;if(i|j){k=j+-1|0;h=i+-1|0;h>>>0<4294967295&&(k=k+1|0);h=r(i^h)+32|0;i=r(j^k);i=(i|0)==32?h:i;j=63-i|0;v=0-(63<i>>>0)|0;return j}v=0;return 64}function ma(i){var j=0,h;j=n[520];h=i+3&-4;i=j+h|0;a:{if(i>>>0<=j>>>0?(h|0)>=1:0)break a;if(i>>>0>xa()<<16>>>0&&!t(i|0))break a;n[520]=i;return j}n[516]=48;return-1}function Q(h){var i;i=u-16|0;n[i+12>>2]=h;h=1;a:{if(n[i+12>>2]==5)break a;h=1;if(n[i+12>>2]==6)break a;h=1;if(n[i+12>>2]==7)break a;h=n[i+12>>2]==8}return h}function R(){var i=0,j,h;while(1){j=i<<4;h=j+1024|0;n[j+1028>>2]=h;n[j+1032>>2]=h;i=i+1|0;if((i|0)!=64)continue;break}D(48)}function S(k,l,h,m,i,j,n){k=k|0;l=l|0;h=h|0;m=m|0;i=i|0;j=j|0;n=n|0;return B(k,l,h,m,i,j,n)|0}function T(k,l,h,m,i,j){k=k|0;l=l|0;h=h|0;m=m|0;i=i|0;j=j|0;return w(k,l,h,m,i,j)|0}function na(k,l,h,m,i,j){k=k|0;l=l|0;h=h|0;m=m|0;i=i|0;j=j|0;return C(k,l,h,m,i,j)|0}function oa(j,k,h,l,i){j=j|0;k=k|0;h=h|0;l=l|0;i=i|0;return F(j,k,h,l,i)|0}function U(i,j,h,k){i=i|0;j=j|0;h=h|0;k=k|0;return I(i,j,h,k)|0}function pa(i,j,h){i=i|0;j=j|0;h=h|0;return ha(i,j,h)|0}function V(i,j,h){i=i|0;j=j|0;h=h|0;return J(i,j,h)|0}function W(i,j,h){i=i|0;j=j|0;h=h|0;return N(i,j,h)|0}function X(h,i){h=h|0;i=i|0;return q(i,20)+h|0}function Y(h,i){h=h|0;i=i|0;return ka(h,i)|0}function qa(h,i){h=h|0;i=i|0;return P(h,i)|0}function ra(h,i){h=h|0;i=i|0;return ia(h,i)|0}function sa(h,i){h=h|0;i=i|0;return ja(h,i)|0}function Z(h){h=h|0;return o[h+4|0]>>>1|0}function $(h){h=h|0;return o[h+8|0]>>>1|0}function ta(h){h=h|0;return n[h>>2]&15}function ua(h){h=h|0;return m[h+4|0]&1}function va(h){h=h|0;return n[h+16>>2]}function wa(h){h=h|0;return m[h+8|0]&1}function aa(h){h=h|0;return n[h+12>>2]}function ba(h){h=h|0;return n[h+8>>2]}function ca(h){h=h|0;return ya(h|0)|0}function da(h){h=h|0;return o[h+4|0]}function ea(h){h=h|0;return y(h)|0}function fa(h){h=h|0,H(h)}function ga(){R()}function xa(){return j.byteLength/65536|0}function ya(h){h=h|0;var k=xa()|0;h=k+h|0;if(k<h&&h<65536){h=new ArrayBuffer(q(h,65536));var r=new i.Int8Array(h);r.set(m);m=r;m=new i.Int8Array(h);new i.Int16Array(h);n=new i.Int32Array(h);o=new i.Uint8Array(h);new i.Uint16Array(h);p=new i.Uint32Array(h);new i.Float32Array(h);new i.Float64Array(h);j=h;l.buffer=h}return k}return{__wasm_call_ctors:ga,_malloc:ea,_free:fa,_DgwCodecEncodeEmpty:ra,_DgwCodecEncodeDirectStream_Ack:pa,_DgwCodecEncodeDeauth:sa,_DgwCodecEncodeDrain:V,_DgwCodecEncodeDirectStream_Data:na,_DgwCodecEncodeStreamGroup_EstablishStream:oa,_DgwCodecEncodeStreamGroup_EndOfData:W,_DgwCodecEncodeStreamGroup_Data:S,_DgwCodecEncodeStreamGroup_Ack:U,_DgwCodecEncodePing:Y,_DgwCodecEncodePong:qa,_DgwCodecDecode:T,_getFrameType:ta,_getAckIdFromAckFrame:Z,_getAckIdFromDataFrame:Z,_getRequiresAckFromDataFrame:ua,_getDataFromDataFrame:ba,_getDataSizeFromDataFrame:aa,_getDrainReasonFromDrainFrame:da,_getDGWFramePtr:X,_getStreamIdFromStreamGroupFrame:da,_getEncodedParamsFromEstablishStreamFrame:ba,_getEncodedParamsSizeFromEstablishStreamFrame:aa,_getDataFromGroupedStreamDataFrame:aa,_getDataSizeFromGroupedStreamDataFrame:va,_getAckIdFromGroupedStreamDataFrame:$,_getRequiresAckFromGroupedStreamDataFrame:wa,_getAckIdFromGroupedStreamAckFrame:$,__growWasmMemory:ca}}return j({Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:Infinity,Math:Math},k,i.buffer)}(ca,B,C);return{exports:i}},instantiate:function(h,i){return{then:function(i){i({instance:new A.Instance(new A.Module(h))})}}},RuntimeError:Error};z=[];typeof A!=="object"&&y("no native wasm support detected");var B,C=new A.Table({initial:1,maximum:1+0,element:"anyfunc"}),D=!1;function E(h,i){h||U("Assertion failed: "+i)}q=65536;function F(h,i){h%i>0&&(h+=i-h%i);return h}var G,H,I;function J(h){G=h,k.HEAP8=new Int8Array(h),k.HEAP16=new Int16Array(h),k.HEAP32=I=new Int32Array(h),k.HEAPU8=H=new Uint8Array(h),k.HEAPU16=new Uint16Array(h),k.HEAPU32=new Uint32Array(h),k.HEAPF32=new Float32Array(h),k.HEAPF64=new Float64Array(h)}p=5245120;var ha=2080,K=k.INITIAL_MEMORY||8388608;k.wasmMemory?B=k.wasmMemory:B=new A.Memory({initial:K/q,maximum:2147483648/q});B&&(G=B.buffer);G.byteLength;J(G);I[ha>>2]=p;function L(h){while(h.length>0){var i=h.shift();if(typeof i=="function"){i(k);continue}var j=i.func;typeof j==="number"?i.arg===void 0?k.dynCall_v(j):k.dynCall_vi(j,i.arg):j(i.arg===void 0?null:i.arg)}}var M=[],N=[],O=[],P=[];function ia(){if(k.preRun){typeof k.preRun=="function"&&(k.preRun=[k.preRun]);while(k.preRun.length)ma(k.preRun.shift())}L(M)}function ja(){L(N)}function ka(){L(O)}function la(){if(k.postRun){typeof k.postRun=="function"&&(k.postRun=[k.postRun]);while(k.postRun.length)Q(k.postRun.shift())}L(P)}function ma(h){M.unshift(h)}function Q(h){P.unshift(h)}var R=0,S=null,T=null;function na(h){R++,k.monitorRunDependencies&&k.monitorRunDependencies(R)}function oa(h){R--;k.monitorRunDependencies&&k.monitorRunDependencies(R);if(R==0){S!==null&&(clearInterval(S),S=null);if(T){h=T;T=null;h()}}}k.preloadedImages={};k.preloadedAudios={};function U(h){k.onAbort&&k.onAbort(h);h+="";x(h);y(h);D=!0;h="abort("+h+"). Build with -s ASSERTIONS=1 for more info.";throw new A.RuntimeError(h)}function pa(h,i){return String.prototype.startsWith?h.startsWith(i):h.indexOf(i)===0}var V="data:application/octet-stream;base64,";function W(h){return pa(h,V)}var X="dgwcppbridge.wasm";W(X)||(X=v(X));function Y(){try{if(z)return new Uint8Array(z);var h=ba(X);if(h)return h;if(w)return w(X);else throw"both async and sync fetching of the wasm failed"}catch(h){U(h)}}function qa(){return!z&&(s||t)&&typeof fetch==="function"?fetch(X,{credentials:"same-origin"}).then(function(h){if(!h.ok)throw"failed to load wasm binary file at '"+X+"'";return h.arrayBuffer()})["catch"](function(){return Y()}):new(i("Promise"))(function(h,i){h(Y())})}function ra(){var i={env:ca,wasi_snapshot_preview1:ca};function j(i,h){h=i.exports;k.asm=h;oa("wasm-instantiate")}na("wasm-instantiate");function n(h){j(h.instance)}function o(h){return qa().then(function(h){return A.instantiate(h,i)}).then(h,function(h){y("failed to asynchronously prepare wasm: "+h),U(h)})}function p(){if(!z&&typeof A.instantiateStreaming==="function"&&!W(X)&&typeof fetch==="function")fetch(X,{credentials:"same-origin"}).then(function(h){h=A.instantiateStreaming(h,i);return h.then(n,function(h){y("wasm streaming compile failed: "+h);y("falling back to ArrayBuffer instantiation");return o(n)})});else return o(n)}if(k.instantiateWasm)try{var h=k.instantiateWasm(i,j);return h}catch(h){y("Module.instantiateWasm callback failed with error: "+h);return!1}p();return{}}N.push({func:function(){da()}});function sa(h,i,j){H.copyWithin(h,i,i+j)}function Z(){return H.length}function $(h){try{B.grow(h-G.byteLength+65535>>>16);J(B.buffer);return 1}catch(h){}}function ta(h){h=h>>>0;var i=Z(),j=65536,k=2147483648;if(h>k)return!1;var l=16777216;for(var m=1;m<=4;m*=2){var n=i*(1+.2/m);n=Math.min(n,h+100663296);n=Math.min(k,F(Math.max(l,h,n),j));n=$(n);if(n)return!0}return!1}var ua=!1;function va(h){var i=[];for(var j=0;j<h.length;j++){var k=h[j];k>255&&(ua&&E(!1,"Character code "+k+" ("+String.fromCharCode(k)+")  at offset "+j+" not in 0x00-0xFF."),k&=255);i.push(String.fromCharCode(k))}return i.join("")}var wa=typeof atob==="function"?atob:function(h){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",j="",k,l,m,n,o,p=0;h=h.replace(/[^A-Za-z0-9\+\/\=]/g,"");do l=i.indexOf(h.charAt(p++)),m=i.indexOf(h.charAt(p++)),n=i.indexOf(h.charAt(p++)),o=i.indexOf(h.charAt(p++)),l=l<<2|m>>4,m=(m&15)<<4|n>>2,k=(n&3)<<6|o,j=j+String.fromCharCode(l),n!==64&&(j=j+String.fromCharCode(m)),o!==64&&(j=j+String.fromCharCode(k));while(p<h.length);return j};function aa(h){try{h=wa(h);var i=new Uint8Array(h.length);for(var j=0;j<h.length;++j)i[j]=h.charCodeAt(j);return i}catch(h){throw new Error("Converting base64 string to bytes failed.")}}function ba(h){if(!W(h))return;return aa(h.slice(V.length))}var ca={emscripten_memcpy_big:sa,emscripten_resize_heap:ta,memory:B,table:C};K=ra();k.asm=K;var da=k.___wasm_call_ctors=function(){return(da=k.___wasm_call_ctors=k.asm.__wasm_call_ctors).apply(null,arguments)};k.__malloc=function(){return(k.__malloc=k.asm._malloc).apply(null,arguments)};k.__free=function(){return(k.__free=k.asm._free).apply(null,arguments)};k.__DgwCodecEncodeEmpty=function(){return(k.__DgwCodecEncodeEmpty=k.asm._DgwCodecEncodeEmpty).apply(null,arguments)};k.__DgwCodecEncodeDirectStream_Ack=function(){return(k.__DgwCodecEncodeDirectStream_Ack=k.asm._DgwCodecEncodeDirectStream_Ack).apply(null,arguments)};k.__DgwCodecEncodeDeauth=function(){return(k.__DgwCodecEncodeDeauth=k.asm._DgwCodecEncodeDeauth).apply(null,arguments)};k.__DgwCodecEncodeDrain=function(){return(k.__DgwCodecEncodeDrain=k.asm._DgwCodecEncodeDrain).apply(null,arguments)};k.__DgwCodecEncodeDirectStream_Data=function(){return(k.__DgwCodecEncodeDirectStream_Data=k.asm._DgwCodecEncodeDirectStream_Data).apply(null,arguments)};k.__DgwCodecEncodeStreamGroup_EstablishStream=function(){return(k.__DgwCodecEncodeStreamGroup_EstablishStream=k.asm._DgwCodecEncodeStreamGroup_EstablishStream).apply(null,arguments)};k.__DgwCodecEncodeStreamGroup_EndOfData=function(){return(k.__DgwCodecEncodeStreamGroup_EndOfData=k.asm._DgwCodecEncodeStreamGroup_EndOfData).apply(null,arguments)};k.__DgwCodecEncodeStreamGroup_Data=function(){return(k.__DgwCodecEncodeStreamGroup_Data=k.asm._DgwCodecEncodeStreamGroup_Data).apply(null,arguments)};k.__DgwCodecEncodeStreamGroup_Ack=function(){return(k.__DgwCodecEncodeStreamGroup_Ack=k.asm._DgwCodecEncodeStreamGroup_Ack).apply(null,arguments)};k.__DgwCodecEncodePing=function(){return(k.__DgwCodecEncodePing=k.asm._DgwCodecEncodePing).apply(null,arguments)};k.__DgwCodecEncodePong=function(){return(k.__DgwCodecEncodePong=k.asm._DgwCodecEncodePong).apply(null,arguments)};k.__DgwCodecDecode=function(){return(k.__DgwCodecDecode=k.asm._DgwCodecDecode).apply(null,arguments)};k.__getFrameType=function(){return(k.__getFrameType=k.asm._getFrameType).apply(null,arguments)};k.__getAckIdFromAckFrame=function(){return(k.__getAckIdFromAckFrame=k.asm._getAckIdFromAckFrame).apply(null,arguments)};k.__getAckIdFromDataFrame=function(){return(k.__getAckIdFromDataFrame=k.asm._getAckIdFromDataFrame).apply(null,arguments)};k.__getRequiresAckFromDataFrame=function(){return(k.__getRequiresAckFromDataFrame=k.asm._getRequiresAckFromDataFrame).apply(null,arguments)};k.__getDataFromDataFrame=function(){return(k.__getDataFromDataFrame=k.asm._getDataFromDataFrame).apply(null,arguments)};k.__getDataSizeFromDataFrame=function(){return(k.__getDataSizeFromDataFrame=k.asm._getDataSizeFromDataFrame).apply(null,arguments)};k.__getDrainReasonFromDrainFrame=function(){return(k.__getDrainReasonFromDrainFrame=k.asm._getDrainReasonFromDrainFrame).apply(null,arguments)};k.__getDGWFramePtr=function(){return(k.__getDGWFramePtr=k.asm._getDGWFramePtr).apply(null,arguments)};k.__getStreamIdFromStreamGroupFrame=function(){return(k.__getStreamIdFromStreamGroupFrame=k.asm._getStreamIdFromStreamGroupFrame).apply(null,arguments)};k.__getEncodedParamsFromEstablishStreamFrame=function(){return(k.__getEncodedParamsFromEstablishStreamFrame=k.asm._getEncodedParamsFromEstablishStreamFrame).apply(null,arguments)};k.__getEncodedParamsSizeFromEstablishStreamFrame=function(){return(k.__getEncodedParamsSizeFromEstablishStreamFrame=k.asm._getEncodedParamsSizeFromEstablishStreamFrame).apply(null,arguments)};k.__getDataFromGroupedStreamDataFrame=function(){return(k.__getDataFromGroupedStreamDataFrame=k.asm._getDataFromGroupedStreamDataFrame).apply(null,arguments)};k.__getDataSizeFromGroupedStreamDataFrame=function(){return(k.__getDataSizeFromGroupedStreamDataFrame=k.asm._getDataSizeFromGroupedStreamDataFrame).apply(null,arguments)};k.__getAckIdFromGroupedStreamDataFrame=function(){return(k.__getAckIdFromGroupedStreamDataFrame=k.asm._getAckIdFromGroupedStreamDataFrame).apply(null,arguments)};k.__getRequiresAckFromGroupedStreamDataFrame=function(){return(k.__getRequiresAckFromGroupedStreamDataFrame=k.asm._getRequiresAckFromGroupedStreamDataFrame).apply(null,arguments)};k.__getAckIdFromGroupedStreamAckFrame=function(){return(k.__getAckIdFromGroupedStreamAckFrame=k.asm._getAckIdFromGroupedStreamAckFrame).apply(null,arguments)};var ea=k.__growWasmMemory=function(){return(ea=k.__growWasmMemory=k.asm.__growWasmMemory).apply(null,arguments)};k.asm=K;var fa;T=function h(){fa||ga(),fa||(T=h)};function ga(h){h||r;if(R>0)return;ia();if(R>0)return;function i(){if(fa)return;fa=!0;k.calledRun=!0;if(D)return;ja();ka();o(k);k.onRuntimeInitialized&&k.onRuntimeInitialized();la()}k.setStatus?(k.setStatus("Running..."),setTimeout(function(){setTimeout(function(){k.setStatus("")},1),i()},1)):i()}k.run=ga;if(k.preInit){typeof k.preInit=="function"&&(k.preInit=[k.preInit]);while(k.preInit.length>0)k.preInit.pop()()}ga();return k.ready}}();typeof m==="object"&&typeof l==="object"?l.exports=n:typeof define==="function"&&define.amd?define([],function(){return n}):typeof m==="object"&&(m.Module=n)}),null);
__d("DGWUtils",["DGWConstants","DGWCppBridge","DGWLoggingContext","Random","URI","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";f.uuidv4=a;var g,h=4;function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=b("Random").random()*16|0;a=a=="x"?c:c&3|8;return a.toString(16)})}var i=null;c=function(){function a(){}a.initialize=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:if(!(i!=null)){a.next=2;break}return a.abrupt("return");case 2:a.next=4;return b("regeneratorRuntime").awrap(b("DGWCppBridge")());case 4:i=a.sent;case 5:case"end":return a.stop()}},null,this)};a.constructConnectUrl=function(a){var c,d,e=a.appId,f=a.appVersion,h=a.authType,i=a.dgwVersion,j=a.fbId,k=a.tier,l=a.loggingId,m=a.headers,n=a.endpoint,o=a.serviceId;a=a.regionHint;var p=(c={},c[(d=b("DGWConstants")).HEADER_CONSTANTS.HEADER_APPID]=e,c[d.HEADER_CONSTANTS.HEADER_APPVERSION]=f,c[d.HEADER_CONSTANTS.HEADER_AUTHTYPE]=h,c[d.HEADER_CONSTANTS.HEADER_DGW_VERSION]=i,c[d.HEADER_CONSTANTS.HEADER_UUID]=j,c[d.HEADER_CONSTANTS.HEADER_TARGET_TIER]=k,c);l!==void 0&&(p[b("DGWConstants").HEADER_CONSTANTS.HEADER_LOGGING_ID]=l);a!==void 0&&(p[b("DGWConstants").HEADER_CONSTANTS.HEADER_REGIONHINT]=a);Object.keys(m).forEach(function(a){var c=b("DGWConstants").HEADER_CONSTANTS.APPHEADER_PREFIX+a;Object.prototype.hasOwnProperty.call(p,c)||(p[c]=m[a])});e=new(g||(g=b("URI")))(n);e.setQueryData(p);e.setPath(e.getPath()+"/"+o);return e.toString()};return a}();f.DGWUtils=c;d=function(){function a(a,b){this.$1=null,this.$2=a,this.$3=b}a.initialize=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:if(!(i!=null)){a.next=2;break}return a.abrupt("return");case 2:a.next=4;return b("regeneratorRuntime").awrap(b("DGWCppBridge")());case 4:i=a.sent;case 5:case"end":return a.stop()}},null,this)};var c=a.prototype;c.malloc=function(a){return i.__malloc(a)};c.free=function(a){i.__free(a)};c.append=function(a){if(this.$1==null){this.$1=a;return}var b=this.$1.length,c=new Uint8Array(b+a.length);c.set(this.$1,0);c.set(a,b);this.$1=c};c.processData=function(){var a=this;if(this.$1==null)return;var c=this.$1.length,d=this.malloc(c),e=i.HEAPU8.subarray(d,d+c);if(this.$1)for(var f=0;f<e.length;++f)e[f]=this.$1[f];f=this.malloc(h*4);if(f==0){(e=this.$2)==null?void 0:e.logError(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Codec memory allocation failure","Could not allocate memory with malloc");return}e=f;var g=e+h,j=g+h,k=j+h;c=i.__DgwCodecDecode(d,c,e,g,j,k);this.free(d);if(c!==b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){this.free(f);(j=this.$2)==null?void 0:j.logError(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Codec Decode Failure","Failed to decode Frame(s). Received error code "+b("DGWConstants").DgwCodecReturnCodeToString(c));return}d=i.HEAPU32.subarray(k/h,k/h+1)[0];if(this.$1==null){this.free(f);return}j=this.$1.length-d;this.$1&&this.$1.length>j?this.$1=new Uint8Array(this.$1.slice(j)):this.$1=null;c=i.HEAPU32.subarray(g/h,g/h+1)[0];k=i.HEAPU32.subarray(e/h,e/h+1)[0];var l=[];for(var d=0;d<c;++d){var m=i.__getDGWFramePtr(k,d);j=i.__getFrameType(m);switch(j){case b("DGWConstants").DgwFrameType.DgwFrameType_Ack:g=function(){var c;(c=a.$2)==null?void 0:c.logEvent(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Received ACK Frame from server");var d=i.__getAckIdFromAckFrame(m);l.push(function(){var b;(b=a.$3)==null?void 0:b.handleAckReceived(d)});return"break"}();if(g==="break")break;case b("DGWConstants").DgwFrameType.DgwFrameType_Data:e=function(){var c;(c=a.$2)==null?void 0:c.logEvent(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Received Data Frame from server");c=i.__getDataFromDataFrame(m);var d=i.HEAPU8.subarray(c,c+i.__getDataSizeFromDataFrame(m)).slice();a.free(c);var e=i.__getRequiresAckFromDataFrame(m)?i.__getAckIdFromDataFrame(m):null;l.push(function(){var b;return(b=a.$3)==null?void 0:b.onDataReceived(Uint8Array.from(d),e)});return"break"}();if(e==="break")break;case b("DGWConstants").DgwFrameType.DgwFrameType_Drain:j=function(){var c=i.__getDrainReasonFromDrainFrame(m),d=b("DGWConstants").drainReasonToDrainReasonString(c);(c=a.$2)==null?void 0:c.logEvent(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Received Drain Frame from server","DrainReason: "+d);l.push(function(){var b;return(b=a.$3)==null?void 0:b.receivedDrainSignal(d)});return"break"}();if(j==="break")break;case b("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_EstablishStream:g=function(){var b=i.__getStreamIdFromStreamGroupFrame(m),c=i.__getEncodedParamsFromEstablishStreamFrame(m),d=i.HEAPU8.subarray(c,c+i.__getEncodedParamsSizeFromEstablishStreamFrame(m)).slice();a.free(c);l.push(function(){var c;return(c=a.$3)==null?void 0:c.onGroupedStreamEstablishStreamReceived(b,d)});return"break"}();if(g==="break")break;case b("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_Data:e=function(){var b=i.__getStreamIdFromStreamGroupFrame(m),c=i.__getDataFromGroupedStreamDataFrame(m),d=i.HEAPU8.subarray(c,c+i.__getDataSizeFromGroupedStreamDataFrame(m)).slice();a.free(c);var e=i.__getRequiresAckFromGroupedStreamDataFrame(m)?i.__getAckIdFromGroupedStreamDataFrame(m):null;l.push(function(){var c;return(c=a.$3)==null?void 0:c.onGroupedStreamDataReceived(b,d,e)});return"break"}();if(e==="break")break;case b("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_Ack:j=function(){var b=i.__getStreamIdFromStreamGroupFrame(m),c=i.__getAckIdFromGroupedStreamAckFrame(m);l.push(function(){var d;return(d=a.$3)==null?void 0:d.onGroupedStreamAckReceived(b,c)});return"break"}();if(j==="break")break;case b("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_EndOfData:g=function(){var b=i.__getStreamIdFromStreamGroupFrame(m);l.push(function(){var c;return(c=a.$3)==null?void 0:c.onGroupedStreamEndOfDataReceived(b)});return"break"}();if(g==="break")break;case b("DGWConstants").DgwFrameType.DgwFrameType_Ping:l.push(function(){var b;return(b=a.$3)==null?void 0:b.onPingReceived()});break;case b("DGWConstants").DgwFrameType.DgwFrameType_Pong:l.push(function(){var b;return(b=a.$3)==null?void 0:b.onPongReceived()});break;default:break}this.free(m)}this.free(f);for(var e=0;e<l.length;e++)l[e]()};c.encodeData=function(a,c,d,e){var f=e!=void 0,g=this.malloc(a.length),j=i.HEAPU8.subarray(g,g+a.length);for(var k=0;k<j.length;++k)j[k]=a[k];a=this.malloc(h*2);k=a;var l=a+h,m=b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Failure;f?m=i.__DgwCodecEncodeStreamGroup_Data(e,g,j.length,c,d,k,l):m=i.__DgwCodecEncodeDirectStream_Data(g,j.length,c,d,k,l);this.free(g);if(m!==b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(f=this.$2)==null?void 0:f.logError(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Data Frame encode failure","Failed to decode DGW Data Frame. Received error code "+b("DGWConstants").DgwCodecReturnCodeToString(m));return null}e=i.HEAPU32.subarray(k/h,k/h+1)[0];j=i.HEAPU32.subarray(l/h,l/h+1)[0];c=i.HEAPU8.subarray(e,e+j).slice();this.free(e);this.free(a);return c};c.encodeAck=function(a,c){var d=c!=void 0,e=this.malloc(h*2),f=e,g=e+h,j=b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Failure;d?j=i.__DgwCodecEncodeStreamGroup_Ack(c,a,f,g):j=i.__DgwCodecEncodeDirectStream_Ack(a,f,g);if(j!==b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(d=this.$2)==null?void 0:d.logError(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"ACK Frame encode failure","Failed to encode ACK Frame. Received error code "+b("DGWConstants").DgwCodecReturnCodeToString(j));return null}c=i.HEAPU32.subarray(f/h,f/h+1)[0];a=i.HEAPU32.subarray(g/h,g/h+1)[0];d=i.HEAPU8.subarray(c,c+a).slice();this.free(c);this.free(e);return d};c.encodeDrain=function(a){var c=this.malloc(h*2),d=c,e=c+h;a=i.__DgwCodecEncodeDrain(a,d,e);if(a!==b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Drain Frame encode failure","Failed to encode Drain Frame. Received error code "+b("DGWConstants").DgwCodecReturnCodeToString(a));return null}f=i.HEAPU32.subarray(d/h,d/h+1)[0];a=i.HEAPU32.subarray(e/h,e/h+1)[0];d=i.HEAPU8.subarray(f,f+a).slice();this.free(f);this.free(c);return d};c.encodeEstablishStream=function(a,c){var d=this.malloc(c.length),e=i.HEAPU8.subarray(d,d+c.length);for(var f=0;f<c.length;++f)e[f]=c[f];e=this.malloc(h*2);f=e;var g=e+h;c=i.__DgwCodecEncodeStreamGroup_EstablishStream(a,d,c.length,f,g);this.free(d);if(c!==b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(d=this.$2)==null?void 0:d.logError(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"EstablishStream Frame encode failure","Failed to encode EstablishStream Frame. Received error code "+b("DGWConstants").DgwCodecReturnCodeToString(c)+" for StreamId "+a);return null}d=i.HEAPU32.subarray(f/h,f/h+1)[0];c=i.HEAPU32.subarray(g/h,g/h+1)[0];a=i.HEAPU8.subarray(d,d+c).slice();this.free(d);this.free(e);return a};c.encodeEndOfData=function(a){var c=this.malloc(h*2),d=c,e=c+h;a=i.__DgwCodecEncodeStreamGroup_EndOfData(a,d,e);if(a!==b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"EndOfData Frame encode failure","Failed to encode EndOfData Frame. Received error code "+b("DGWConstants").DgwCodecReturnCodeToString(a));return null}f=i.HEAPU32.subarray(d/h,d/h+1)[0];a=i.HEAPU32.subarray(e/h,e/h+1)[0];d=i.HEAPU8.subarray(f,f+a).slice();this.free(f);this.free(c);return d};c.encodePing=function(){var a=this.malloc(h*2),c=a,d=a+h,e=i.__DgwCodecEncodePing(c,d);if(e!==b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Ping Frame encode failure","Failed to encode Ping Frame. Received error code "+b("DGWConstants").DgwCodecReturnCodeToString(e));return null}f=i.HEAPU32.subarray(c/h,c/h+1)[0];e=i.HEAPU32.subarray(d/h,d/h+1)[0];c=i.HEAPU8.subarray(f,f+e).slice();this.free(f);this.free(a);return c};c.encodePong=function(){var a=this.malloc(h*2),c=a,d=a+h,e=i.__DgwCodecEncodePong(c,d);if(e!==b("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(b("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Pong Frame encode failure","Failed to encode Pong Frame. Received error code "+b("DGWConstants").DgwCodecReturnCodeToString(e));return null}f=i.HEAPU32.subarray(c/h,c/h+1)[0];e=i.HEAPU32.subarray(d/h,d/h+1)[0];c=i.HEAPU8.subarray(f,f+e).slice();this.free(f);this.free(a);return c};return a}();f.DGWCodec=d}),null);
__d("DGWWebSocketTransport",[],(function(a,b,c,d,e,f){"use strict";f.getWebSocketConnection=a;function a(a){a=new WebSocket(a);a.binaryType="arraybuffer";a.onopen=function(){};a.onclose=function(){};a.onerror=function(){};return a}}),null);
__d("DirectStream",["DGWAckManager","DGWConstants","DGWExponentialBackoff","DGWLoggingContext","DGWStream","DGWStreamEvents","DGWUtils","DGWWebSocketTransport","Promise","err","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g="DGW closing websocket connection";a=function(){function a(a){var c=this,d=a.loggingContext,e=a.serviceId,f=a.streamCallbacks,g=a.streamEvents,h=a.streamOptions;a=a.ws;this.$4=!1;this.$2=!0;this.$5=d;this.$1=new(b("DGWAckManager").DGWAckManager)(this.$5);this.$6=1;this.$7=e;this.$8=g;this.$9=f;this.$10=h;this.$3=new(b("DGWUtils").DGWCodec)(this.$5,{onDataReceived:function(a,b){b!=null&&c.$12(b),c.$9.onDataReceived(a)},handleAckReceived:function(a){c.$1.handleAckReceived(a)},receivedDrainSignal:function(a){c.$4===!1&&(c.$9.onStreamMustDrain(c,a),c.$4=!0)},onGroupedStreamDataReceived:function(a,b,c){},onGroupedStreamAckReceived:function(a,b){},onGroupedStreamEndOfDataReceived:function(a){},onGroupedStreamEstablishStreamReceived:function(a,b){},onPingReceived:function(){},onPongReceived:function(){}});this.$11=a}a.getDGWStream=function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:f=c.appId,g=c.appVersion,h=c.authType,i=c.dgwVersion,j=c.endpoint,k=c.fbId,l=c.headers,m=c.serviceId,n=c.streamCallbacks,o=c.streamOptions;v.next=3;return b("regeneratorRuntime").awrap(b("DGWUtils").DGWCodec.initialize());case 3:v.next=5;return b("regeneratorRuntime").awrap(b("DGWUtils").DGWUtils.initialize());case 5:p=(d=o.overrideUrl)!=null?d:j;q=o.loggingId;r=b("DGWUtils").DGWUtils.constructConnectUrl({appId:f,appVersion:g,authType:h,dgwVersion:i,fbId:k,headers:l,loggingId:q,tier:(e=o.serviceTier)!=null?e:b("DGWConstants").DEFAULT_SERVICE_TIER,serviceId:m,endpoint:p,regionHint:o.regionHint});s=new(b("DGWLoggingContext").DGWLoggingContext)(i,q,m,k,null,o.disableFalcoLogging);t=new(b("DGWStreamEvents").DGWStreamEvents)(s,b("DGWLoggingContext").DGWLoggingComponent.STREAM_COMPONENT);u=function(){return a.$13({connectUrl:r,loggingContext:s,serviceId:m,streamCallbacks:n,streamEvents:t,streamOptions:o})};t.streamEstablishmentPending();v.prev=12;v.next=15;return b("regeneratorRuntime").awrap(b("DGWExponentialBackoff").callWithExponentialBackoff(u));case 15:return v.abrupt("return",v.sent);case 18:v.prev=18;v.t0=v["catch"](12);t.streamEstablishmentFailure(v.t0,"Could not establish stream with exponential backoff");throw v.t0;case 22:case"end":return v.stop()}},null,this,[[12,18]])};a.$13=function(c){var d=c.connectUrl,e=c.loggingContext,f=c.serviceId,g=c.streamEvents,h=c.streamCallbacks;c=c.streamOptions;d=b("DGWWebSocketTransport").getWebSocketConnection(d);var i=new a({loggingContext:e,serviceId:f,streamCallbacks:h,streamEvents:g,streamOptions:c,ws:d});i.$11.onmessage=a.$14(i);i.$11.onclose=a.$15(i);i.$11.onerror=function(){};i.$11.onopen=function(){i.$8.streamEstablished(),i.$2=!1};return a.getStreamPromise(i)};a.getStreamPromise=function(a){return new(b("Promise"))(function(c,d){var e=a.$11.onerror;a.$11.onerror=function(){e(),d(b("err")("Stream could not be initialized"))};var f=a.$11.onopen;a.$11.onopen=function(){f(),c(a)}})};a.$15=function(a){return function(c){if(a.$2===!0){a.$8.connectionEstablishmentFailure(c.code);return}a.$2=!0;if(c.code!==b("DGWConstants").WebsocketCloseCodes.DGW_NORMAL_CLOSURE){a.$8.streamClosed(!1,"Websocket connection failure with code "+c.code);switch(c.code){case b("DGWConstants").WebsocketCloseCodes.NORMAL_CLOSURE:a.$9.onError(b("DGWStream").StreamError.ABNORMAL_CLOSURE);break;case b("DGWConstants").WebsocketCloseCodes.ABNORMAL_CLOSURE:a.$9.onError(b("DGWStream").StreamError.ABNORMAL_CLOSURE);break;case b("DGWConstants").WebsocketCloseCodes.SERVER_INTERNAL_ERROR:a.$9.onError(b("DGWStream").StreamError.SERVER_INTERNAL_ERROR);break;case b("DGWConstants").WebsocketCloseCodes.GOING_AWAY:a.$9.onError(b("DGWStream").StreamError.GOING_AWAY);break;default:a.$9.onError(b("DGWStream").StreamError.UNKNOWN_ERROR);break}}else a.$8.streamClosed(!0,""),a.$9.onClose(a);a.$1.clearPendingAcks()}};a.$14=function(a){return function(b){if(!(b.data instanceof ArrayBuffer)){a.$8.error("Incorrect Data Protocol","Received "+typeof b.data+" instead of ArrayBuffer");return}a.$3.append(new Uint8Array(b.data));a.$3.processData()}};var c=a.prototype;c.send=function(a,c){var d,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c===void 0&&(c=b("DGWConstants").DEFAULT_ACK_TIMEOUT_MS);d=this.$6++%b("DGWConstants").MAX_ACK_ID;e=this.$16(a,!0,d);if(!(e===!1)){g.next=5;break}return g.abrupt("return",!1);case 5:g.next=7;return b("regeneratorRuntime").awrap(this.$1.waitForAck(d,c));case 7:f=g.sent;return g.abrupt("return",f);case 9:case"end":return g.stop()}},null,this)};c.$12=function(a){var c=this.$17("Error sending ACK");if(c===!1)return!1;c=this.$3.encodeAck(a);if(c==null||this.$11==null)return!1;try{this.$11.send(c),this.$8.ackSent(a)}catch(a){this.$5.logError(b("DGWLoggingContext").DGWLoggingComponent.STREAM_COMPONENT,"Received error while trying to send ACK","Error: "+a);return!1}return!0};c.sendAndForget=function(a){return this.$16(a,!1,0)};c.__sendDrain=function(a){var c=b("DGWConstants").drainReasonToDrainReasonString(a),d=this.$17("Error simulating drain with reason "+c);if(d===!1)return!1;d=this.$3.encodeDrain(a);if(d==null||this.$11==null)return!1;try{this.$11.send(d),this.$8.drainSent(c)}catch(a){this.$5.logError(b("DGWLoggingContext").DGWLoggingComponent.STREAM_COMPONENT,"Received error while trying to send Drain","Error: "+a);return!1}return!0};c.$16=function(a,c,d){c===void 0&&(c=!1);d===void 0&&(d=0);var e=this.$17("Error sending data");if(e===!1)return!1;e=this.$3.encodeData(a,c,d);if(e==null||this.$11==null)return!1;try{this.$11.send(e)}catch(a){this.$5.logError(b("DGWLoggingContext").DGWLoggingComponent.STREAM_COMPONENT,"Received error while trying to send Data","Error: "+a);return!1}this.$8.dataSent(d,e.length,c);return!0};c.close=function(){this.$2===!1?(this.$5.logEvent(b("DGWLoggingContext").DGWLoggingComponent.STREAM_COMPONENT,"Client called close on stream"),this.$11.close(b("DGWConstants").WebsocketCloseCodes.DGW_NORMAL_CLOSURE,g)):this.$5.logEvent(b("DGWLoggingContext").DGWLoggingComponent.STREAM_COMPONENT,"Client called close on a closed stream")};c.$17=function(a){if(this.$11==null){this.$8.error(a,"Error sending message when websocket was uninitialized");return!1}if(this.$2){this.$8.error(a,"Error sending message when stream was closed locally");return!1}return!0};return a}();f.DirectStream=a}),null);
__d("DGWStreamGroupCallbacks",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({TRANSPORT_SERVER_INTERNAL_ERROR:0,TRANSPORT_ABNORMAL_CLOSURE:1,TRANSPORT_GOING_AWAY:2,TRANSPORT_UNKNOWN_ERROR:3,TRANSPORT_KEEPALIVE_TIMEOUT:4});f.DGWStreamGroupError=a;c=function(){function a(){}var b=a.prototype;b.onStreamGroupError=function(){};b.onStreamGroupMustDrain=function(){};b.onStreamGroupTransportClose=function(){};return a}();f.NoOpDGWStreamGroupCallbacks=c}),null);
__d("DGWStreamCallbacks",[],(function(a,b,c,d,e,f){"use strict"}),null);
__d("GroupedStream",["DGWAckManager","DGWConstants","DGWLoggingContext","DGWStream","DGWStreamEvents","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,c,d,e,f,g,h){this.$1=a,this.$3=!1,this.$4=!1,this.$5=!1,this.$6=c,this.$7=d,this.$8=e,this.$2=g,this.$9=f,this.$10=new(b("DGWAckManager").DGWAckManager)(this.$9),this.$12=new(b("DGWStreamEvents").DGWStreamEvents)(this.$9,b("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,this.$1),this.$11=0,this.$13=h}var c=a.prototype;c.send=function(a,c){var d,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:e=this.$11++%b("DGWConstants").MAX_ACK_ID;if(this.$14(a,!0,e)){g.next=3;break}return g.abrupt("return",!1);case 3:g.next=5;return b("regeneratorRuntime").awrap(this.$10.waitForAck(e,(d=c)!=null?d:b("DGWConstants").DEFAULT_ACK_TIMEOUT_MS));case 5:f=g.sent;return g.abrupt("return",f);case 7:case"end":return g.stop()}},null,this)};c.sendAndForget=function(a){return this.$14(a,!1)};c.close=function(){var a=this.$2.encodeEndOfData(this.$1);if(a==null){this.$9.logError(b("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to encode EndOfData","streamId: "+this.$1);return}a=this.$8.send(a);if(!a){this.$9.logError(b("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send EndOfData","streamId: "+this.$1+". StreamGroupTransport not open during send");return}this.$12.endOfDataSent();this.$5=!0;this.$4&&this.$15()};c.__sendDrain=function(a){var c=b("DGWConstants").drainReasonToDrainReasonString(a);if(this.$5)return!1;a=this.$2.encodeDrain(a);if(a==null)return!1;this.$12.drainSent(c);c=this.$8.send(a);return c};c.__transportCloseHook=function(a){this.$13(),this.$10.clearPendingAcks(),a?(this.$12.error("Received StreamError","StreamErrorType: "+b("DGWStream").streamErrorToString(a)),this.$6.onError(a)):this.$5&&this.$4?this.$15():(this.$12.streamClosed(!1,"Stream closed: ClosedLocally: "+this.$5.toString()+", EndOfDataReceived: "+this.$4.toString()),this.$6.onError(b("DGWStream").StreamError.PREMATURE_CLOSE))};c.$15=function(){this.$13(),this.$12.streamClosed(!0,"Graceful close"),this.$6.onClose(this)};c.__dataReceivedHook=function(a,b){this.$12.dataReceived(a.length,b!=null,b),b!=null&&this.$16(b),this.$6.onDataReceived(a)};c.__ackReceivedHook=function(a){this.$12.ackReceived(a),this.$10.handleAckReceived(a)};c.__drainReceivedHook=function(a){this.$3===!1&&(this.$6.onStreamMustDrain(this,a),this.$3=!0)};c.__endOfDataHook=function(){this.$12.endOfDataReceived(),this.$4=!0,this.$5?this.$15():this.$6.onServerHasFinishedSendingData(this)};c.$14=function(a,c,d){c===void 0&&(c=!1);d===void 0&&(d=0);if(this.$5){this.$9.logError(b("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send data","Stream closed locally");return!1}a=this.$2.encodeData(a,c,d,this.$1);if(a==null)return!1;var e=this.$8.send(a);if(!e){this.$9.logError(b("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send data","ClosedLocally: "+this.$5.toString());return!1}this.$12.dataSent(d,a.length,c);return!0};c.$16=function(a){var c=this.$2.encodeAck(a,this.$1);if(c==null){this.$9.logError(b("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to encode ACK","ackId: "+a);return!1}c=this.$8.send(c);if(!c){this.$9.logError(b("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send ACK","ackId: "+a);return!1}this.$12.ackSent(a);return!0};return a}();f.GroupedStream=a}),null);
__d("StreamGroupContext",[],(function(a,b,c,d,e,f){"use strict"}),null);
__d("DGWPinger",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c){this.$1=a,this.$4=b,this.$5=c,this.$3=!1}var b=a.prototype;b.$6=function(){var a=this;this.$3?(this.$3=!1,this.$4(),this.$2=setTimeout(function(){a.$6()},this.$1)):this.$5()};b.reset=function(){var a=this;this.$3=!0;this.$2&&(clearTimeout(this.$2),this.$2=null);this.$1>0&&(this.$2=setTimeout(function(){a.$6()},this.$1))};b.cancel=function(){this.$2&&(clearTimeout(this.$2),this.$2=null)};return a}();f.DGWPinger=a}),null);
__d("DGWTransportEvents",["DGWLoggingContext"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$3=a}var c=a.prototype;c.transportEstablished=function(){this.$3.logEvent(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"open"),this.$2=Date.now()};c.transportEstablishmentPending=function(){this.$1=Date.now(),this.$3.logEvent(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transportPending")};c.transportClosed=function(a,c){this.$4=Date.now(),a?(this.$3.bumpODSKey(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transport_close_graceful"),this.$3.logEvent(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Transport closed gracefully")):(this.$3.bumpODSKey(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transport_close_with_error"),this.$3.logError(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Transport closed abnormally",c))};c.transportEstablishmentFailure=function(a){this.$3.logError(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"WebSocket transport establishment failure","WebSocket close code: "+a)};c.streamEstablishmentTimeout=function(a,c){this.$3.logError(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment timeout",a,"streamId:"+c)};c.streamEstablishmentPending=function(a){this.$3.logEvent(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment pending","streamId:"+a)};c.streamEstablishmentSuccess=function(a){this.$3.logEvent(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment success","streamId:"+a)};c.transportError=function(a,c,d){this.$3.logError(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,a,c,d)};c.receivedFrameForInactiveStream=function(a,c,d){this.$3.logWarn(b("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Frame received for inactive stream","frameType: "+a+", streamID: "+c,d)};return a}();f.DGWTransportEvents=a}),null);
__d("StreamIdGenerator",["err"],(function(a,b,c,d,e,f){"use strict";var g=255;a=function(){function a(){this.$1=new Set();for(var a=1;a<=g;++a)this.$1.add(a)}var c=a.prototype;c.getNextStreamId=function(){var a;if(this.$1.size===0)throw b("err")("Max number of stream IDs reached");a=(a=this.$1.values().next().value)!=null?a:0;this.$1["delete"](a);return a};c.putBackStreamId=function(a){this.$1.add(a)};return a}();f.StreamIdGenerator=a}),null);
__d("StreamGroupWebSocketTransport",["DGWConstants","DGWExponentialBackoff","DGWPinger","DGWStream","DGWStreamGroupCallbacks","DGWTransportEvents","DGWUtils","DGWWebSocketTransport","GroupedStream","Promise","StreamIdGenerator","err","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=function(a,c,d,e,f){var g=this;this.groupedStream=a;this.$1=setTimeout(function(){d(b("err")("Stream establishment timed out"))},e);this.handleEstablishFrameReceived=function(){clearTimeout(g.$1),c(g.groupedStream)};this.abortStream=function(a){f(),d(b("err")("Received StreamError: "+b("DGWStream").streamErrorToString(a)))}};a=function(){function a(a,c,d,e,f){var g=this;this.$13=e;this.$1=a;this.$9=new(b("StreamIdGenerator").StreamIdGenerator)();this.$4=new Map();this.$5=new Map();this.$6=d.keepAliveMs;this.$7=!1;this.$3=!0;this.$11=c;this.$10=new TextEncoder();this.$12=d;e={onDataReceived:function(){},handleAckReceived:function(){},receivedDrainSignal:function(a){g.$12.streamGroupCallbacks.onStreamGroupMustDrain(a),g.$4.forEach(function(b){b.__drainReceivedHook(a)})},onGroupedStreamDataReceived:function(a,b,c){if(g.$4.has(a)){var d=g.$4.get(a);d==null?void 0:d.__dataReceivedHook(b,c)}else{g.$11.receivedFrameForInactiveStream("Data",a,"sendAckID: "+((d=c)!=null?d:"null"))}},onGroupedStreamAckReceived:function(a,b){if(g.$4.has(a)){var c=g.$4.get(a);c==null?void 0:c.__ackReceivedHook(b)}else{g.$11.receivedFrameForInactiveStream("ACK",a,"ackId: "+((c=b)!=null?c:"null"))}},onGroupedStreamEndOfDataReceived:function(a){if(g.$4.has(a)){var b=g.$4.get(a);b==null?void 0:b.__endOfDataHook()}else g.$11.receivedFrameForInactiveStream("EndOfData",a)},onGroupedStreamEstablishStreamReceived:function(a,b){if(g.$5.has(a)){b=g.$5.get(a);g.$5["delete"](a);b==null?void 0:b.handleEstablishFrameReceived()}else g.$11.receivedFrameForInactiveStream("EstablishStream",a,"EstablishStream received for non-inflight stream")},onPingReceived:function(){var a=g.$2.encodePing();if(a==null)return;g.$1.send(a)},onPongReceived:function(){}};this.$2=new(b("DGWUtils").DGWCodec)(f,e)}var c=a.prototype;c.send=function(a){try{this.$1.send(a);return!0}catch(a){this.$11.transportError("Failed to send over transport","readyState: "+this.$1.readyState,a.toString());return!1}};c.close=function(){this.$1.close(b("DGWConstants").WebsocketCloseCodes.DGW_NORMAL_CLOSURE)};c.abort=function(a,b,c,d){this.$7=!0,this.$11.transportClosed(!1,d),this.$4.forEach(function(a){a.__transportCloseHook(b)}),this.$5.forEach(function(a){a.abortStream(b)}),this.$12.streamGroupCallbacks.onStreamGroupError(a),this.$4.clear(),this.$5.clear(),this.$1.close(c)};a.getTransport=function(c,d,e,f){var g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return b("regeneratorRuntime").awrap(b("DGWUtils").DGWCodec.initialize());case 2:g=new(b("DGWTransportEvents").DGWTransportEvents)(e);g.transportEstablishmentPending();h=function(){return a.$14(c,d,g,f,e)};i.prev=5;i.next=8;return b("regeneratorRuntime").awrap(b("DGWExponentialBackoff").callWithExponentialBackoff(h));case 8:return i.abrupt("return",i.sent);case 11:i.prev=11;i.t0=i["catch"](5);throw i.t0;case 14:case"end":return i.stop()}},null,this,[[5,11]])};c.establishGroupedStream=function(a,c,d){var e=this,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:f=this.$9.getNextStreamId();g=new(b("GroupedStream").GroupedStream)(f,a,c,this,d,this.$2,function(){e.streamEndCallback(f)});h=this.$2.encodeEstablishStream(f,Uint8Array.from(this.$10.encode(JSON.stringify(this.$15(c.groupedStreamHeaders)))));if(!(h==null)){j.next=6;break}throw b("err")("Failed to encode EstablishStreamFrame");case 6:this.$1.send(h);case 7:j.prev=7;this.$11.streamEstablishmentPending(f);j.next=11;return b("regeneratorRuntime").awrap(this.waitForEstablishStream(g,f));case 11:i=j.sent;this.$4.set(f,g);this.$11.streamEstablishmentSuccess(f);return j.abrupt("return",i);case 17:j.prev=17;j.t0=j["catch"](7);this.$11.streamEstablishmentTimeout("Stream establishment timeout",f);throw j.t0;case 21:case"end":return j.stop()}},null,this,[[7,17]])};c.$15=function(a){return Object.keys(a).reduce(function(c,d){c[""+b("DGWConstants").HEADER_CONSTANTS.APPHEADER_PREFIX+d]=a[d];return c},{})};c.waitForEstablishStream=function(a,c){var d=this,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;break;return f.abrupt("return",a);case 2:f.next=4;return b("regeneratorRuntime").awrap(new(b("Promise"))(function(b,e){d.$5.set(c,new g(a,b,e,3e4,function(){d.streamEndCallback(c)}))}));case 4:e=f.sent;return f.abrupt("return",e);case 6:case"end":return f.stop()}},null,this)};a.$14=function(c,d,e,f,g){var h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:h=b("DGWWebSocketTransport").getWebSocketConnection(c);i=new a(h,e,d,f,g);h.onmessage=a.$16(i);h.onopen=function(){e.transportEstablished(),i.$3=!1,i.$6!=null&&(i.$8=new(b("DGWPinger").DGWPinger)(i.$6,function(){i.$17()},function(){i.abort(b("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_KEEPALIVE_TIMEOUT,b("DGWStream").StreamError.KEEPALIVE_TIMEOUT,b("DGWConstants").WebsocketCloseCodes.DGW_PING_TIMEOUT,"Aborting transport because of keepalive timeout")}))};h.onerror=function(){};h.onclose=a.$18(i);k.next=8;return b("regeneratorRuntime").awrap(a.getTransportPromise(i));case 8:j=k.sent;return k.abrupt("return",j);case 10:case"end":return k.stop()}},null,this)};a.getTransportPromise=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(new(b("Promise"))(function(c,d){var e=a.$1.onerror,f=a.$1.onopen;a.$1.onerror=function(){e(),d(b("err")("Transport could not be initialized"))};a.$1.onopen=function(){f(),c(a)}}));case 2:c=d.sent;return d.abrupt("return",c);case 4:case"end":return d.stop()}},null,this)};a.$16=function(a){return function(b){var c;(c=a.$8)==null?void 0:c.reset();if(!(b.data instanceof ArrayBuffer)){a.$11.transportError("Incorrect Data Protocol","Received "+typeof b.data+" instead of ArrayBuffer");return}a.$2.append(new Uint8Array(b.data));a.$2.processData()}};a.$18=function(a){return function(c){var d;(d=a.$8)==null?void 0:d.cancel();if(a.$7===!0)return;if(a.$3===!0){a.$11.transportEstablishmentFailure(c.code);a.$4.clear();return}a.$13();a.$3=!0;if(c.code!==b("DGWConstants").WebsocketCloseCodes.DGW_NORMAL_CLOSURE){a.$11.transportClosed(!1,"Websocket connection failure with code "+c.code);d=b("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNKNOWN_ERROR;var e=b("DGWStream").StreamError.UNKNOWN_ERROR;switch(c.code){case b("DGWConstants").WebsocketCloseCodes.NORMAL_CLOSURE:d=b("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_ABNORMAL_CLOSURE;e=b("DGWStream").StreamError.ABNORMAL_CLOSURE;break;case b("DGWConstants").WebsocketCloseCodes.ABNORMAL_CLOSURE:d=b("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_ABNORMAL_CLOSURE;e=b("DGWStream").StreamError.ABNORMAL_CLOSURE;break;case b("DGWConstants").WebsocketCloseCodes.SERVER_INTERNAL_ERROR:d=b("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_SERVER_INTERNAL_ERROR;e=b("DGWStream").StreamError.SERVER_INTERNAL_ERROR;break;case b("DGWConstants").WebsocketCloseCodes.GOING_AWAY:d=b("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_GOING_AWAY;e=b("DGWStream").StreamError.GOING_AWAY;break;default:d=b("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNKNOWN_ERROR;e=b("DGWStream").StreamError.UNKNOWN_ERROR;break}a.$12.streamGroupCallbacks.onStreamGroupError(d);a.$4.forEach(function(a){a.__transportCloseHook(e)});a.$5.forEach(function(a){a.abortStream(e)})}else a.$11.transportClosed(!0,""),a.$4.forEach(function(a){a.__transportCloseHook()}),a.$12.streamGroupCallbacks.onStreamGroupTransportClose(),a.$5.forEach(function(a){a.abortStream(b("DGWStream").StreamError.TRANSPORT_CLOSED_BEFORE_STREAM_INIT)});a.$4.clear();a.$5.clear()}};c.$17=function(){var a=this.$2.encodePing();if(a==null)throw b("err")("Failed to encode Ping Frame");this.send(a)};c.isClosedLocally=function(){return this.$3||this.$7};c.streamEndCallback=function(a){this.$4["delete"](a),this.$9.putBackStreamId(a),this.$4.size===0&&this.$5.size===0&&this.close()};return a}();f.StreamGroupWebSocketTransport=a}),null);
__d("StreamGroup",["DGWConstants","DGWLoggingContext","DGWUtils","Promise","StreamGroupWebSocketTransport","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,c,d,e,f,g,h,i,j){this.$2=j;this.$1=j.getNewStreamGroupId();j=(j=h.overrideUrl)!=null?j:f;this.$3={appId:a,appVersion:c,authType:d,dgwVersion:e,headers:h.streamGroupAppHeaders,tier:(f=h.serviceTier)!=null?f:b("DGWConstants").DEFAULT_SERVICE_TIER,connectEndpoint:j,fbId:g,loggingId:h.loggingId,serviceId:h.serviceId,streamGroupCallbacks:i,keepAliveMs:h.keepAliveMs};this.$4=h;this.$5=new(b("DGWLoggingContext").DGWLoggingContext)(this.$3.dgwVersion,null,this.$3.serviceId,this.$3.fbId,this.$4.loggingId)}var c=a.prototype;c.establishStream=function(a,c){var d=this,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:if(!(this.$2.containsStreamGroup(this.$1)===!1)){g.next=6;break}e=b("DGWUtils").DGWUtils.constructConnectUrl({appId:this.$3.appId,appVersion:this.$3.appVersion,authType:this.$3.authType,dgwVersion:this.$3.dgwVersion,fbId:this.$3.fbId,headers:babelHelpers["extends"]({},this.$3.headers),loggingId:a.loggingId,tier:this.$3.tier,serviceId:this.$3.serviceId,endpoint:this.$3.connectEndpoint,regionHint:this.$4.regionHint});g.next=4;return b("regeneratorRuntime").awrap(b("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransport(e,this.$3,this.$5,function(){d.$2.removeStreamGroupAndTransport(d.$1)}));case 4:f=g.sent,this.$2.setStreamGroupAndTransport(this.$1,f);case 6:return g.abrupt("return",this.establishStreamWithTransport(a,c));case 7:case"end":return g.stop()}},null,this)};c.establishStreamWithTransport=function(a,c){var d=this,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(new(b("Promise"))(function(e){var f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:g=a.loggingId;d.$5.logEvent(b("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"establishing Stream loggingId: "+((f=g)!=null?f:""));i.next=4;return b("regeneratorRuntime").awrap(d.$2.getStreamGroupTransport(d.$1).establishGroupedStream(c,a,new(b("DGWLoggingContext").DGWLoggingContext)(d.$3.dgwVersion,g,d.$3.serviceId,d.$3.fbId,d.$3.loggingId,a.disableFalcoLogging)));case 4:h=i.sent,e(h);case 6:case"end":return i.stop()}},null,this)}));case 2:e=f.sent;return f.abrupt("return",e);case 4:case"end":return f.stop()}},null,this)};return a}();f.StreamGroup=a}),null);
__d("StreamGroupRegistry",["Random","err"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Map(),this.$2=new Set()}var c=a.prototype;c.setStreamGroupAndTransport=function(a,b){this.$1.set(a,b)};c.containsStreamGroup=function(a){return this.$1.has(a)};c.removeStreamGroupAndTransport=function(a){this.$1["delete"](a)};c.getStreamGroupTransport=function(a){a=this.$1.get(a);if(a==void 0)throw b("err")("No stream group transport");return a};c.getNewStreamGroupId=function(){var a=b("Random").uint32();while(this.$2.has(a))a=b("Random").uint32();this.$2.add(a);return a};return a}();f.StreamGroupRegistry=a}),null);
__d("RawDGWClient",["CurrentUser","DirectStream","StreamGroup","StreamGroupRegistry","err"],(function(a,b,c,d,e,f){"use strict";var g="4";a=function(){function a(a){var c=a.appId,d=a.appVersion,e=a.authType,f=a.dgwVersion,g=a.endpoint;a=a.fbId;this.$1=c;this.$2=d;this.$3=e;this.$4=f;this.$5=g;this.$6=a;this.$7=new(b("StreamGroupRegistry").StreamGroupRegistry)()}var c=a.prototype;c.establishDGWStream=function(a,c,d,e){this.handleUserChecks();return b("DirectStream").DirectStream.getDGWStream({appId:this.$1,appVersion:this.$2,authType:this.$3,dgwVersion:this.$4,endpoint:this.$5,headers:a,fbId:this.$6,serviceId:c,streamCallbacks:d,streamOptions:e})};c.establishDGWStreamWithInitialData=function(a,b,c,d,e){this.handleUserChecks();a=this.establishDGWStream(a,c,d,e);c=a.then(function(a){return a.send(b)});return{sendPromise:c,streamPromise:a}};c.createStreamGroup=function(a,c){return new(b("StreamGroup").StreamGroup)(this.$1,this.$2,this.$3,g,this.$5,this.$6,c,a,this.$7)};c.handleUserChecks=function(){if(!b("CurrentUser").isLoggedInNow())throw b("err")("DGWClientError: User is not logged in")};return a}();f.RawDGWClient=a}),null);
__d("DGWClient",["DGWAuth","DGWWebConfig","RawDGWClient","err","isDGWEnvCompatible"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g=new(b("RawDGWClient").RawDGWClient)({appId:(c=b("DGWWebConfig")).appId,appVersion:c.appVersion,authType:b("DGWAuth").fromStringToDGWAuth(c.authType),dgwVersion:c.dgwVersion,endpoint:c.endpoint,fbId:c.fbId});function a(){if(b("isDGWEnvCompatible")())return g;else throw b("err")("unsupported_environment_retry_with_mqtt")}}),null);
__d("DGWStreamGroupHandler",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c){this.$1=a,this.$2=b,this.$3=c}var b=a.prototype;b.onStreamGroupError=function(a){this.$1(a)};b.onStreamGroupMustDrain=function(a){this.$2(a)};b.onStreamGroupTransportClose=function(){this.$3()};return a}();e.exports=a}),null);
__d("DGWStreamFactory",["DGWClient","DGWStreamGroupHandler","DGWStreamGroupType","uuid"],(function(a,b,c,d,e,f){"use strict";var g="realtime",h=1e4;a=function(){function a(){this.$1=null}var c=a.prototype;c.establishStream=function(a,c,d,e,f){var i=this;e===void 0&&(e=b("DGWStreamGroupType").DGWStreamGroupType.NONE);f===void 0&&(f=!1);switch(e){case b("DGWStreamGroupType").DGWStreamGroupType.SINGLE:return b("DGWClient")().createStreamGroup(new(b("DGWStreamGroupHandler"))(function(){},function(){},function(){}),{loggingId:d.loggingId,serviceId:g,disableFalcoLogging:d.disableFalcoLogging,streamGroupAppHeaders:{}}).establishStream({loggingId:d.loggingId,disableFalcoLogging:d.disableFalcoLogging,groupedStreamHeaders:a},c);case b("DGWStreamGroupType").DGWStreamGroupType.MULTI:if(this.$1==null){e={loggingId:b("uuid")(),serviceId:g,disableFalcoLogging:d.disableFalcoLogging,streamGroupAppHeaders:{"stream-group":"group1"}};f&&(e.keepAliveMs=h);this.$1=new(b("DGWClient"))().createStreamGroup(new(b("DGWStreamGroupHandler"))(function(){i.$1=null},function(){i.$1=null},function(){i.$1=null}),e)}return this.$1.establishStream({loggingId:d.loggingId,disableFalcoLogging:d.disableFalcoLogging,groupedStreamHeaders:a},c);default:return b("DGWClient")().establishDGWStream(a,g,c,d)}};return a}();e.exports=a}),null);
__d("DGWStreamFactorySingleton",["DGWStreamFactory"],(function(a,b,c,d,e,f){"use strict";a=new(b("DGWStreamFactory"))();e.exports=a}),null);
__d("DGWStreamHandler",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c,d,e){this.$2=a,this.$3=b,this.$4=c,this.$5=d,this.$6=e,this.$1=!0}var b=a.prototype;b.onClose=function(a){if(!this.$1)return;this.$2(a)};b.onDataReceived=function(a){if(!this.$1)return;this.$3(a)};b.onError=function(a){if(!this.$1)return;this.$4(a)};b.onStreamMustDrain=function(a,b){if(!this.$1)return;this.$5(a,b)};b.onServerHasFinishedSendingData=function(a){if(!this.$1)return;this.$6(a)};b.stop=function(){this.$1=!1};b.isStopped=function(){return!this.$1};return a}();e.exports=a}),null);
__d("InflightAmends",["Deferred","err"],(function(a,b,c,d,e,f){"use strict";var g="inflight_amends_timeout",h="inflight_amends_duplicate_id";a=function(){function a(a,b,c){this.$1=a,this.$3=b,this.$4=c,this.$2=new Map()}var c=a.prototype;c.add=function(a){var c=this;if(this.$2.has(a))throw b("err")(h);var d=new(b("Deferred"))(),e=Date.now(),f=setTimeout(function(){c.$2.has(a)&&c.reject(a,b("err")(g))},this.$1);this.$2.set(a,{id:a,deferred:d,createdTimestampMs:e,timeoutId:f});return d.getPromise()};c.getPromise=function(a){return(a=this.$5(a))==null?void 0:a.deferred.getPromise()};c.resolve=function(a,b){a=this.$5(a);a&&(a.deferred.resolve==null?void 0:a.deferred.resolve(b),this.$3(a.id,Date.now()-a.createdTimestampMs),this.$6(a))};c.reject=function(a,b){a=this.$5(a);a&&(a.deferred.reject==null?void 0:a.deferred.reject(b),this.$4(a.id,b),this.$6(a))};c.$6=function(a){clearTimeout(a.timeoutId),this.$2["delete"](a.id)};c.$5=function(a){return this.$2.get(a)};return a}();e.exports=a}),null);
__d("RequestStreamCommonRequestStreamCommonSerializers",["RequestStreamCommonRequestStreamCommonTypes","ThriftTypes","jsbi"],(function(a,b,c,d,e,f){"use strict";a=function(){return{}};c=function(){return{bytes:Uint8Array.of()}};d=function(){return{message:""}};f=function(){return{reason:b("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0)}};var g=function(){return{}},h=function(){return{stream_id:"0",last_sequencer:0,amendment_count:0,last_status:b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0)}},i=function(){return{caller_timestamp_ms:"0"}},j=function(){return{original_ping_timestamp_ms:"0"}},k=function(){return{}},l=function(a,c){c.writeStructBegin("ResponseRewriteRequest"),a.new_headers!=null&&(c.writeFieldBegin({fname:"new_headers",ftype:b("ThriftTypes").STRING,fid:1}),c.writeString(a.new_headers)),a.new_body!=null&&(c.writeFieldBegin({fname:"new_body",ftype:b("ThriftTypes").STRING,fid:2}),c.writeBinary(a.new_body)),a.patch_headers!=null&&(c.writeFieldBegin({fname:"patch_headers",ftype:b("ThriftTypes").STRING,fid:3}),c.writeString(a.patch_headers)),a.kill_body!=null&&(c.writeFieldBegin({fname:"kill_body",ftype:b("ThriftTypes").BOOL,fid:4}),c.writeBool(a.kill_body)),a.temporary!=null&&(c.writeFieldBegin({fname:"temporary",ftype:b("ThriftTypes").BOOL,fid:5}),c.writeBool(a.temporary)),c.writeFieldStop(),c.writeStructEnd()},m=function(a,c){c.writeStructBegin("ResponseData");c.writeFieldBegin({fname:"bytes",ftype:b("ThriftTypes").STRING,fid:1});if(a.bytes!=null)c.writeBinary(a.bytes);else{var d=Uint8Array.of();c.writeBinary(d)}a.metadata!=null&&(c.writeFieldBegin({fname:"metadata",ftype:b("ThriftTypes").STRING,fid:2}),c.writeString(a.metadata));c.writeFieldStop();c.writeStructEnd()},n=function(a,c){c.writeStructBegin("LogMessage");c.writeFieldBegin({fname:"message",ftype:b("ThriftTypes").STRING,fid:1});if(a.message!=null)c.writeString(a.message);else{a="";c.writeString(a)}c.writeFieldStop();c.writeStructEnd()},o=function(a,c){c.writeStructBegin("Termination");c.writeFieldBegin({fname:"reason",ftype:b("ThriftTypes").I32,fid:1});if(a.reason!=null){var d;c.writeI32((d=a.reason)!=null?d:0)}else{d=b("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0);c.writeI32((d=d)!=null?d:0)}a.message!=null&&(c.writeFieldBegin({fname:"message",ftype:b("ThriftTypes").STRING,fid:2}),c.writeString(a.message));a.retry_delay_ms!=null&&(c.writeFieldBegin({fname:"retry_delay_ms",ftype:b("ThriftTypes").I64,fid:3}),c.writeI64(b("jsbi").BigInt(a.retry_delay_ms)));c.writeFieldStop();c.writeStructEnd()},p=function(a,c){c.writeStructBegin("AmendStreamAck"),a.amendment_id!=null&&(c.writeFieldBegin({fname:"amendment_id",ftype:b("ThriftTypes").I64,fid:1}),c.writeI64(b("jsbi").BigInt(a.amendment_id))),a.accepted!=null&&(c.writeFieldBegin({fname:"accepted",ftype:b("ThriftTypes").BOOL,fid:2}),c.writeBool(a.accepted)),a.result!=null&&(c.writeFieldBegin({fname:"result",ftype:b("ThriftTypes").STRING,fid:3}),c.writeBinary(a.result)),c.writeFieldStop(),c.writeStructEnd()},q=function(a,c){c.writeStructBegin("StreamCheck");c.writeFieldBegin({fname:"stream_id",ftype:b("ThriftTypes").I64,fid:1});if(a.stream_id!=null)c.writeI64(b("jsbi").BigInt(a.stream_id));else{var d="0";c.writeI64(b("jsbi").BigInt(d))}c.writeFieldBegin({fname:"last_sequencer",ftype:b("ThriftTypes").I32,fid:2});if(a.last_sequencer!=null)c.writeI32(a.last_sequencer);else{d=0;c.writeI32(d)}c.writeFieldBegin({fname:"amendment_count",ftype:b("ThriftTypes").I32,fid:4});if(a.amendment_count!=null)c.writeI32(a.amendment_count);else{d=0;c.writeI32(d)}c.writeFieldBegin({fname:"last_status",ftype:b("ThriftTypes").I32,fid:3});if(a.last_status!=null){c.writeI32((d=a.last_status)!=null?d:0)}else{a=b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0);c.writeI32((d=a)!=null?d:0)}c.writeFieldStop();c.writeStructEnd()},r=function(a,c){c.writeStructBegin("Ping");c.writeFieldBegin({fname:"caller_timestamp_ms",ftype:b("ThriftTypes").I64,fid:1});if(a.caller_timestamp_ms!=null)c.writeI64(b("jsbi").BigInt(a.caller_timestamp_ms));else{var d="0";c.writeI64(b("jsbi").BigInt(d))}if(a.streams_to_check!=null){c.writeFieldBegin({fname:"streams_to_check",ftype:b("ThriftTypes").LIST,fid:2});c.writeListBegin({etype:b("ThriftTypes").STRUCT,size:a.streams_to_check.length});for(var d=a.streams_to_check,a=Array.isArray(d),e=0,d=a?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(a){if(e>=d.length)break;f=d[e++]}else{e=d.next();if(e.done)break;f=e.value}f=f;q(f,c)}}c.writeFieldStop();c.writeStructEnd()},s=function(a,c){c.writeStructBegin("Pong");c.writeFieldBegin({fname:"original_ping_timestamp_ms",ftype:b("ThriftTypes").I64,fid:1});if(a.original_ping_timestamp_ms!=null)c.writeI64(b("jsbi").BigInt(a.original_ping_timestamp_ms));else{var d="0";c.writeI64(b("jsbi").BigInt(d))}if(a.stream_ids_missing!=null){c.writeFieldBegin({fname:"stream_ids_missing",ftype:b("ThriftTypes").LIST,fid:2});c.writeListBegin({etype:b("ThriftTypes").I64,size:a.stream_ids_missing.length});for(var d=a.stream_ids_missing,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;c.writeI64(b("jsbi").BigInt(g))}}if(a.stream_ids_behind!=null){c.writeFieldBegin({fname:"stream_ids_behind",ftype:b("ThriftTypes").LIST,fid:3});c.writeListBegin({etype:b("ThriftTypes").I64,size:a.stream_ids_behind.length});for(var g=a.stream_ids_behind,f=Array.isArray(g),e=0,g=f?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(e>=g.length)break;d=g[e++]}else{e=g.next();if(e.done)break;d=e.value}d=d;c.writeI64(b("jsbi").BigInt(d))}}if(a.stream_ids_with_lost_amendments!=null){c.writeFieldBegin({fname:"stream_ids_with_lost_amendments",ftype:b("ThriftTypes").LIST,fid:4});c.writeListBegin({etype:b("ThriftTypes").I64,size:a.stream_ids_with_lost_amendments.length});for(var d=a.stream_ids_with_lost_amendments,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;c.writeI64(b("jsbi").BigInt(g))}}if(a.stream_ids_with_wrong_status!=null){c.writeFieldBegin({fname:"stream_ids_with_wrong_status",ftype:b("ThriftTypes").LIST,fid:5});c.writeListBegin({etype:b("ThriftTypes").I64,size:a.stream_ids_with_wrong_status.length});for(var g=a.stream_ids_with_wrong_status,f=Array.isArray(g),e=0,g=f?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(f){if(e>=g.length)break;d=g[e++]}else{e=g.next();if(e.done)break;d=e.value}a=d;c.writeI64(b("jsbi").BigInt(a))}}c.writeFieldStop();c.writeStructEnd()},t=function(a,c){c.writeStructBegin("StreamResponseDelta");if(a.flow_status!=null){var d;c.writeFieldBegin({fname:"flow_status",ftype:b("ThriftTypes").I32,fid:1});c.writeI32((d=a.flow_status)!=null?d:0);c.writeFieldStop();c.writeStructEnd();return}if(a.log!=null){c.writeFieldBegin({fname:"log",ftype:b("ThriftTypes").STRUCT,fid:2});n(a.log,c);c.writeFieldStop();c.writeStructEnd();return}if(a.rewrite!=null){c.writeFieldBegin({fname:"rewrite",ftype:b("ThriftTypes").STRUCT,fid:3});l(a.rewrite,c);c.writeFieldStop();c.writeStructEnd();return}if(a.data!=null){c.writeFieldBegin({fname:"data",ftype:b("ThriftTypes").STRUCT,fid:4});m(a.data,c);c.writeFieldStop();c.writeStructEnd();return}if(a.termination!=null){c.writeFieldBegin({fname:"termination",ftype:b("ThriftTypes").STRUCT,fid:5});o(a.termination,c);c.writeFieldStop();c.writeStructEnd();return}if(a.amend_ack!=null){c.writeFieldBegin({fname:"amend_ack",ftype:b("ThriftTypes").STRUCT,fid:6});p(a.amend_ack,c);c.writeFieldStop();c.writeStructEnd();return}c.writeFieldStop();c.writeStructEnd()},u=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").STRING?c.new_headers=a.readString():a.skip(e);break;case 2:e===b("ThriftTypes").STRING?c.new_body=a.readBinary():a.skip(e);break;case 3:e===b("ThriftTypes").STRING?c.patch_headers=a.readString():a.skip(e);break;case 4:e===b("ThriftTypes").BOOL?c.kill_body=a.readBool():a.skip(e);break;case 5:e===b("ThriftTypes").BOOL?c.temporary=a.readBool():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return c},v=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").STRING?c.bytes=a.readBinary():a.skip(e);break;case 2:e===b("ThriftTypes").STRING?c.metadata=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.bytes===void 0&&(c.bytes=Uint8Array.of());return c},w=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").STRING?c.message=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.message===void 0&&(c.message="");return c},x=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").I32?c.reason=b("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(a.readI32()):a.skip(e);break;case 2:e===b("ThriftTypes").STRING?c.message=a.readString():a.skip(e);break;case 3:e===b("ThriftTypes").I64?c.retry_delay_ms=a.readI64().toString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.reason===void 0&&(c.reason=b("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0));return c},y=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").I64?c.amendment_id=a.readI64().toString():a.skip(e);break;case 2:e===b("ThriftTypes").BOOL?c.accepted=a.readBool():a.skip(e);break;case 3:e===b("ThriftTypes").STRING?c.result=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return c},z=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").I64?c.stream_id=a.readI64().toString():a.skip(e);break;case 2:e===b("ThriftTypes").I32?c.last_sequencer=a.readI32():a.skip(e);break;case 4:e===b("ThriftTypes").I32?c.amendment_count=a.readI32():a.skip(e);break;case 3:e===b("ThriftTypes").I32?c.last_status=b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(a.readI32()):a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.stream_id===void 0&&(c.stream_id="0");c.last_sequencer===void 0&&(c.last_sequencer=0);c.amendment_count===void 0&&(c.amendment_count=0);c.last_status===void 0&&(c.last_status=b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0));return c},A=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").I64?c.caller_timestamp_ms=a.readI64().toString():a.skip(e);break;case 2:if(e===b("ThriftTypes").LIST){c.streams_to_check=[];d=a.readListBegin();for(var f=0;f<d.size;f++){var g=z(a);c.streams_to_check.push(g)}}else a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.caller_timestamp_ms===void 0&&(c.caller_timestamp_ms="0");return c},B=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").I64?c.original_ping_timestamp_ms=a.readI64().toString():a.skip(e);break;case 2:if(e===b("ThriftTypes").LIST){c.stream_ids_missing=[];d=a.readListBegin();for(var f=0;f<d.size;f++){var g=a.readI64().toString();c.stream_ids_missing.push(g)}}else a.skip(e);break;case 3:if(e===b("ThriftTypes").LIST){c.stream_ids_behind=[];g=a.readListBegin();for(var f=0;f<g.size;f++){d=a.readI64().toString();c.stream_ids_behind.push(d)}}else a.skip(e);break;case 4:if(e===b("ThriftTypes").LIST){c.stream_ids_with_lost_amendments=[];d=a.readListBegin();for(var f=0;f<d.size;f++){g=a.readI64().toString();c.stream_ids_with_lost_amendments.push(g)}}else a.skip(e);break;case 5:if(e===b("ThriftTypes").LIST){c.stream_ids_with_wrong_status=[];g=a.readListBegin();for(var f=0;f<g.size;f++){d=a.readI64().toString();c.stream_ids_with_wrong_status.push(d)}}else a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.original_ping_timestamp_ms===void 0&&(c.original_ping_timestamp_ms="0");return c},C=function(a){var c,d={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===b("ThriftTypes").STOP)break;switch(e){case 1:if(f===b("ThriftTypes").I32)if(c==null)d.flow_status=b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(a.readI32()),c="flow_status";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: flow_status, previous deserialized field: "+c);else a.skip(f);break;case 2:if(f===b("ThriftTypes").STRUCT)if(c==null)d.log=w(a),c="log";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: log, previous deserialized field: "+c);else a.skip(f);break;case 3:if(f===b("ThriftTypes").STRUCT)if(c==null)d.rewrite=u(a),c="rewrite";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: rewrite, previous deserialized field: "+c);else a.skip(f);break;case 4:if(f===b("ThriftTypes").STRUCT)if(c==null)d.data=v(a),c="data";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: data, previous deserialized field: "+c);else a.skip(f);break;case 5:if(f===b("ThriftTypes").STRUCT)if(c==null)d.termination=x(a),c="termination";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: termination, previous deserialized field: "+c);else a.skip(f);break;case 6:if(f===b("ThriftTypes").STRUCT)if(c==null)d.amend_ack=y(a),c="amend_ack";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: amend_ack, previous deserialized field: "+c);else a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();return d};e.exports={AmendStreamAck$DefaultConstructor:g,LogMessage$DefaultConstructor:d,Ping$DefaultConstructor:i,Pong$DefaultConstructor:j,ResponseData$DefaultConstructor:c,ResponseRewriteRequest$DefaultConstructor:a,StreamCheck$DefaultConstructor:h,StreamResponseDelta$DefaultConstructor:k,Termination$DefaultConstructor:f,deserializeAmendStreamAck:y,deserializeLogMessage:w,deserializePing:A,deserializePong:B,deserializeResponseData:v,deserializeResponseRewriteRequest:u,deserializeStreamCheck:z,deserializeStreamResponseDelta:C,deserializeTermination:x,serializeAmendStreamAck:p,serializeLogMessage:n,serializePing:r,serializePong:s,serializeResponseData:m,serializeResponseRewriteRequest:l,serializeStreamCheck:q,serializeStreamResponseDelta:t,serializeTermination:o}}),null);
__d("RequestStreamSingleChannelSingleChannelRequestStreamTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Ignored:100,Success:200,Queued:250,UnknownStream:400,HandledUnknownResult:450,Failure:500});c=b("$InternalEnum")({Request_headers:"request_headers",Request_body:"request_body",Amend:"amend",Ack:"ack",Response:"response",Ping:"ping",Pong:"pong"});e.exports={Ack:a,Payload$Types:c}}),null);
__d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers",["RequestStreamCommonRequestStreamCommonSerializers","RequestStreamCommonRequestStreamCommonTypes","RequestStreamSingleChannelSingleChannelRequestStreamTypes","ThriftTypes","jsbi"],(function(a,b,c,d,e,f){"use strict";a=function(){return{}};c=function(){return{body:Uint8Array.of()}};d=function(){return{amendment:Uint8Array.of()}};f=function(){return{ack:b("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0)}};var g=function(){return{delta:[]}},h=function(){return{}},i=function(a,c){c.writeStructBegin("RequestStreamHeaders"),a.headers!=null&&(c.writeFieldBegin({fname:"headers",ftype:b("ThriftTypes").STRING,fid:1}),c.writeBinary(a.headers)),a.instrumentation_data!=null&&(c.writeFieldBegin({fname:"instrumentation_data",ftype:b("ThriftTypes").STRING,fid:2}),c.writeBinary(a.instrumentation_data)),c.writeFieldStop(),c.writeStructEnd()},j=function(a,c){c.writeStructBegin("RequestStreamBody");c.writeFieldBegin({fname:"body",ftype:b("ThriftTypes").STRING,fid:1});if(a.body!=null)c.writeBinary(a.body);else{a=Uint8Array.of();c.writeBinary(a)}c.writeFieldStop();c.writeStructEnd()},k=function(a,c){c.writeStructBegin("AmendStream");a.amendment_id!=null&&(c.writeFieldBegin({fname:"amendment_id",ftype:b("ThriftTypes").I64,fid:1}),c.writeI64(b("jsbi").BigInt(a.amendment_id)));c.writeFieldBegin({fname:"amendment",ftype:b("ThriftTypes").STRING,fid:2});if(a.amendment!=null)c.writeBinary(a.amendment);else{var d=Uint8Array.of();c.writeBinary(d)}a.is_query!=null&&(c.writeFieldBegin({fname:"is_query",ftype:b("ThriftTypes").BOOL,fid:3}),c.writeBool(a.is_query));a.instrumentation_data!=null&&(c.writeFieldBegin({fname:"instrumentation_data",ftype:b("ThriftTypes").STRING,fid:4}),c.writeBinary(a.instrumentation_data));c.writeFieldStop();c.writeStructEnd()},l=function(a,c){c.writeStructBegin("StreamResponseAck");a.response_id!=null&&(c.writeFieldBegin({fname:"response_id",ftype:b("ThriftTypes").I64,fid:1}),c.writeI64(b("jsbi").BigInt(a.response_id)));c.writeFieldBegin({fname:"ack",ftype:b("ThriftTypes").I32,fid:2});if(a.ack!=null){var d;c.writeI32((d=a.ack)!=null?d:0)}else{d=b("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0);c.writeI32((d=d)!=null?d:0)}a.query_result!=null&&(c.writeFieldBegin({fname:"query_result",ftype:b("ThriftTypes").STRING,fid:3}),c.writeBinary(a.query_result));c.writeFieldStop();c.writeStructEnd()},m=function(a,c){c.writeStructBegin("StreamResponse");a.response_id!=null&&(c.writeFieldBegin({fname:"response_id",ftype:b("ThriftTypes").I64,fid:1}),c.writeI64(b("jsbi").BigInt(a.response_id)));c.writeFieldBegin({fname:"delta",ftype:b("ThriftTypes").LIST,fid:2});if(a.delta!=null){c.writeListBegin({etype:b("ThriftTypes").STRUCT,size:a.delta.length});for(var d=a.delta,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;b("RequestStreamCommonRequestStreamCommonSerializers").serializeStreamResponseDelta(g,c)}}else{g=[];c.writeListBegin({etype:b("ThriftTypes").STRUCT,size:g.length});for(var f=0;f<g.length;f++){e=g[f];b("RequestStreamCommonRequestStreamCommonSerializers").serializeStreamResponseDelta(e,c)}}if(a.ack_level!=null){c.writeFieldBegin({fname:"ack_level",ftype:b("ThriftTypes").I32,fid:3});c.writeI32((d=a.ack_level)!=null?d:0)}a.query_request!=null&&(c.writeFieldBegin({fname:"query_request",ftype:b("ThriftTypes").STRING,fid:4}),c.writeBinary(a.query_request));a.instrumentation_data!=null&&(c.writeFieldBegin({fname:"instrumentation_data",ftype:b("ThriftTypes").STRING,fid:5}),c.writeBinary(a.instrumentation_data));c.writeFieldStop();c.writeStructEnd()},n=function(a,c){c.writeStructBegin("Payload");if(a.request_headers!=null){c.writeFieldBegin({fname:"request_headers",ftype:b("ThriftTypes").STRUCT,fid:1});i(a.request_headers,c);c.writeFieldStop();c.writeStructEnd();return}if(a.request_body!=null){c.writeFieldBegin({fname:"request_body",ftype:b("ThriftTypes").STRUCT,fid:2});j(a.request_body,c);c.writeFieldStop();c.writeStructEnd();return}if(a.amend!=null){c.writeFieldBegin({fname:"amend",ftype:b("ThriftTypes").STRUCT,fid:3});k(a.amend,c);c.writeFieldStop();c.writeStructEnd();return}if(a.ack!=null){c.writeFieldBegin({fname:"ack",ftype:b("ThriftTypes").STRUCT,fid:4});l(a.ack,c);c.writeFieldStop();c.writeStructEnd();return}if(a.response!=null){c.writeFieldBegin({fname:"response",ftype:b("ThriftTypes").STRUCT,fid:5});m(a.response,c);c.writeFieldStop();c.writeStructEnd();return}if(a.ping!=null){c.writeFieldBegin({fname:"ping",ftype:b("ThriftTypes").STRUCT,fid:6});b("RequestStreamCommonRequestStreamCommonSerializers").serializePing(a.ping,c);c.writeFieldStop();c.writeStructEnd();return}if(a.pong!=null){c.writeFieldBegin({fname:"pong",ftype:b("ThriftTypes").STRUCT,fid:7});b("RequestStreamCommonRequestStreamCommonSerializers").serializePong(a.pong,c);c.writeFieldStop();c.writeStructEnd();return}c.writeFieldStop();c.writeStructEnd()},o=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").STRING?c.headers=a.readBinary():a.skip(e);break;case 2:e===b("ThriftTypes").STRING?c.instrumentation_data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return c},p=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").STRING?c.body=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.body===void 0&&(c.body=Uint8Array.of());return c},q=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").I64?c.amendment_id=a.readI64().toString():a.skip(e);break;case 2:e===b("ThriftTypes").STRING?c.amendment=a.readBinary():a.skip(e);break;case 3:e===b("ThriftTypes").BOOL?c.is_query=a.readBool():a.skip(e);break;case 4:e===b("ThriftTypes").STRING?c.instrumentation_data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.amendment===void 0&&(c.amendment=Uint8Array.of());return c},r=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").I64?c.response_id=a.readI64().toString():a.skip(e);break;case 2:e===b("ThriftTypes").I32?c.ack=b("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(a.readI32()):a.skip(e);break;case 3:e===b("ThriftTypes").STRING?c.query_result=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.ack===void 0&&(c.ack=b("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0));return c},s=function(a){var c={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===b("ThriftTypes").STOP)break;switch(d){case 1:e===b("ThriftTypes").I64?c.response_id=a.readI64().toString():a.skip(e);break;case 2:if(e===b("ThriftTypes").LIST){c.delta=[];d=a.readListBegin();for(var f=0;f<d.size;f++){var g=b("RequestStreamCommonRequestStreamCommonSerializers").deserializeStreamResponseDelta(a);c.delta.push(g)}}else a.skip(e);break;case 3:e===b("ThriftTypes").I32?c.ack_level=b("RequestStreamCommonRequestStreamCommonTypes").AckLevel.cast(a.readI32()):a.skip(e);break;case 4:e===b("ThriftTypes").STRING?c.query_request=a.readBinary():a.skip(e);break;case 5:e===b("ThriftTypes").STRING?c.instrumentation_data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();c.delta===void 0&&(c.delta=[]);return c},t=function(a){var c,d={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===b("ThriftTypes").STOP)break;switch(e){case 1:if(f===b("ThriftTypes").STRUCT)if(c==null)d.request_headers=o(a),c="request_headers";else throw new Error("more than one field have been deserialized in union type: Payload; current field: request_headers, previous deserialized field: "+c);else a.skip(f);break;case 2:if(f===b("ThriftTypes").STRUCT)if(c==null)d.request_body=p(a),c="request_body";else throw new Error("more than one field have been deserialized in union type: Payload; current field: request_body, previous deserialized field: "+c);else a.skip(f);break;case 3:if(f===b("ThriftTypes").STRUCT)if(c==null)d.amend=q(a),c="amend";else throw new Error("more than one field have been deserialized in union type: Payload; current field: amend, previous deserialized field: "+c);else a.skip(f);break;case 4:if(f===b("ThriftTypes").STRUCT)if(c==null)d.ack=r(a),c="ack";else throw new Error("more than one field have been deserialized in union type: Payload; current field: ack, previous deserialized field: "+c);else a.skip(f);break;case 5:if(f===b("ThriftTypes").STRUCT)if(c==null)d.response=s(a),c="response";else throw new Error("more than one field have been deserialized in union type: Payload; current field: response, previous deserialized field: "+c);else a.skip(f);break;case 6:if(f===b("ThriftTypes").STRUCT)if(c==null)d.ping=b("RequestStreamCommonRequestStreamCommonSerializers").deserializePing(a),c="ping";else throw new Error("more than one field have been deserialized in union type: Payload; current field: ping, previous deserialized field: "+c);else a.skip(f);break;case 7:if(f===b("ThriftTypes").STRUCT)if(c==null)d.pong=b("RequestStreamCommonRequestStreamCommonSerializers").deserializePong(a),c="pong";else throw new Error("more than one field have been deserialized in union type: Payload; current field: pong, previous deserialized field: "+c);else a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();return d};e.exports={AmendStream$DefaultConstructor:d,Payload$DefaultConstructor:h,RequestStreamBody$DefaultConstructor:c,RequestStreamHeaders$DefaultConstructor:a,StreamResponse$DefaultConstructor:g,StreamResponseAck$DefaultConstructor:f,deserializeAmendStream:q,deserializePayload:t,deserializeRequestStreamBody:p,deserializeRequestStreamHeaders:o,deserializeStreamResponse:s,deserializeStreamResponseAck:r,serializeAmendStream:k,serializePayload:n,serializeRequestStreamBody:j,serializeRequestStreamHeaders:i,serializeStreamResponse:m,serializeStreamResponseAck:l}}),null);
__d("RequestStreamState",["RequestStreamCommonRequestStreamCommonTypes"],(function(a,b,c,d,e,f){"use strict";f.getNextState=a;function a(a,c){switch(c){case b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted:return a.seenAccepted?a:{flowStatus:b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted,seenAccepted:!0};default:if(!a.seenAccepted||a.flowStatus===c)return a;else return{flowStatus:c,seenAccepted:!0}}}}),null);
__d("DGWRequestStreamRef",["CompactSerializerPolyfill","DGWRequestStreamUtils","DGWStream","DGWStreamFactorySingleton","DGWStreamHandler","FBLogger","InflightAmends","Promise","RTISubscriptionManagerConfig","RequestStreamCloseReason","RequestStreamCommonRequestStreamCommonTypes","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RequestStreamE2ELogger","RequestStreamSingleChannelSingleChannelRequestStreamSerializers","RequestStreamSingleChannelSingleChannelRequestStreamTypes","RequestStreamState","RequestStreamTransport","err","gkx","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=4,h=0,i=5e3,j="requeststream-web",k="dgw_stream_send_ack_failure",l="javascript-sandbox";function m(a){if(!a){a=b("err")(k);a.stack;throw a}}function n(a,b){if(a==null||a.length===0)return null;a=JSON.parse(a);a.auxId=b;return new TextEncoder().encode(JSON.stringify(a))}a=function(){function a(a,c,d,e,f){var h=this;this.$8={};this.$11=!1;this.$16=0;this.$17=0;this.$1={headers:a,body:c!=null?new TextEncoder().encode(c):null};this.$3=d;this.$4=e;this.$5=f;this.$13=g;this.$10=!1;this.$15=!1;!this.$19()?(this.$7=b("FBLogger")(j),this.$6=b("RequestStreamE2ELogger").createStreamLogger(a,this.$5,b("RequestStreamTransport").RequestStreamTransport.WEB_RS_STARGATE)):this.$8.disableFalcoLogging=!0;this.$6&&(this.$8.loggingId=this.$6.getRequestId());e&&e.overrideUrl!=null&&(this.$8.overrideUrl=e.overrideUrl);this.$9={flowStatus:b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped,seenAccepted:!1};this.$18=new(b("InflightAmends"))(i,function(a,c){var d;(d=h.$6)==null?void 0:d.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").AMENDMENT_ACK,b("RequestStreamE2EClientLoggerEvent").RECEIVED,{latency:c.toString()},a)},function(a,c){if(c.message!==k){var d;(d=h.$6)==null?void 0:d.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").AMENDMENT_ACK,b("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:c.message},a)}});(d=this.$6)==null?void 0:d.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,b("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:(a=c==null?void 0:(f=c.length)==null?void 0:f.toString())!=null?a:"0"},"0")}var c=a.prototype;c.amendWithAck=function(a){a=this.$20(a,!0);return a===null||a===void 0?b("Promise").resolve(!1):this.$18.getPromise(a)||b("Promise").resolve(!1)};c.amendWithoutAck=function(a){this.$20(a,!1)};c.cancel=function(){var a;(a=this.$6)==null?void 0:a.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").CANCEL,b("RequestStreamE2EClientLoggerEvent").RECEIVED);this.$10=!0;this.$21(b("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0)};c.start=function(a){var c,d=this;a===void 0&&(a=!1);var e=String(this.$16++),f=Date.now();(c=this.$6)==null?void 0:c.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,b("RequestStreamE2EClientLoggerEvent").SENT,{},e);return this.$22().then(function(){var a;d.$15=!1;var c=(Date.now()-f).toString();(a=d.$6)==null?void 0:a.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,b("RequestStreamE2EClientLoggerEvent").PUBACK,{latency:c},e)})["catch"](function(c){var f;c.stack;if(c.message===k&&d.$11)return;(f=d.$7)==null?void 0:f.catching(c).warn("failed to start dgw stream");(f=d.$6)==null?void 0:f.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,b("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:c.message},e);d.$15=!1;d.$21(a?b("RequestStreamCloseReason").RequestStreamCloseReason.ReestablishError:b("RequestStreamCloseReason").RequestStreamCloseReason.StartStreamFailure,c.message,!0);throw c})};c.getFlowStatus=function(){return this.$9.flowStatus};c.shouldTerminateOrRetry=function(a,c,d,e){var f=this;if(this.$15)return;var g=c;this.$13||(g="cannot retry for error: "+c+" because of hit max retry limitation");c=d&&this.$13;this.$21(a,g,!c);if(c){var i=(d=e)!=null?d:h;this.$15=!0;if(i>0)return new(b("Promise"))(function(a){return setTimeout(a,i)}).then(function(){return f.$23()});else return this.$23()}};c.$24=function(){return this.$12!=null};c.$20=function(a,c){var d,e=this,f=new TextEncoder().encode(a),g=String(this.$17++);(d=this.$6)==null?void 0:d.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").AMENDMENT,b("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:(a=a==null?void 0:(d=a.length)==null?void 0:d.toString())!=null?a:"0"},g);d=n(this.$5,g);a={amend:{amendment:f,instrumentation_data:d}};c&&a.amend&&(a.amend.amendment_id=g);f=b("CompactSerializerPolyfill").serialize(a,b("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload);var h=Date.now();if(this.$25()&&this.$12!=null){c&&this.$18.add(g);this.$12.send(f).then(function(a){var c;m(a);a=(Date.now()-h).toString();(c=e.$6)==null?void 0:c.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").AMENDMENT,b("RequestStreamE2EClientLoggerEvent").PUBACK,{latency:a},g)})["catch"](function(a){var c;(c=e.$6)==null?void 0:c.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").AMENDMENT,b("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:a.message},g);e.$18.reject(g,a)});(d=this.$6)==null?void 0:d.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").AMENDMENT,b("RequestStreamE2EClientLoggerEvent").SENT,{},g);return g}else{(a=this.$6)==null?void 0:a.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").AMENDMENT,b("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"not_started"},g);(c=this.$7)==null?void 0:c.warn("amendWithoutAck when stream has not started")}};c.$22=function(){var a=this,c,d,e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:if(this.$10){k.next=25;break}c=this.$2||this.$1;k.prev=2;f=this.$26();this.$14=f;g=b("DGWRequestStreamUtils").convertHeaders(babelHelpers["extends"]({},c.headers,this.$27()),c.body!=null,this.$5);k.next=8;return b("regeneratorRuntime").awrap(b("DGWStreamFactorySingleton").establishStream(g,f,this.$8,(d=this.$4)==null?void 0:d.streamGroupType,(e=this.$4)==null?void 0:e.usePing));case 8:this.$12=k.sent;k.next=14;break;case 11:k.prev=11;k.t0=k["catch"](2);throw k.t0;case 14:if(!this.$10){k.next=17;break}this.$21(b("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0);return k.abrupt("return");case 17:h=new Uint8Array([]);c.body!=null&&(i={request_body:{body:c.body}},h=b("CompactSerializerPolyfill").serialize(i,b("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload));if(this.$12){k.next=21;break}throw new Error("dgwstream_is_null");case 21:j=this.$12.send(h).then(function(c){m(c),a.$10&&a.$21(b("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0)});return k.abrupt("return",j);case 25:throw new Error("stream_already_canceled");case 26:case"end":return k.stop()}},null,this,[[2,11]])};c.$25=function(){return this.$9.flowStatus===b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started||this.$9.flowStatus===b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted};c.$21=function(a,c,d){var e;this.$12&&a!==b("RequestStreamCloseReason").RequestStreamCloseReason.StreamError&&a!==b("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination&&this.$12.close();(e=this.$14)==null?void 0:e.stop();this.$12=null;this.$11=!0;this.$28(b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped)&&this.$3.onFlowStatus(b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped);d&&!this.$10&&this.$3.onTermination("terminate stream because "+a+" with msg : "+c)};c.$28=function(a){var c=this.$9;this.$9=b("RequestStreamState").getNextState(c,a);return c!==this.$9};c.$23=function(){var a=this;this.$13--;return this.start(!0)["catch"](function(b){var c;(c=a.$7)==null?void 0:c.catching(b).warn("failed to restart dgw stream: "+b.message)})};c.$29=function(a){var c=this;a=b("CompactSerializerPolyfill").deserialize(a,b("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").deserializePayload);if(a.response){var d=b("DGWRequestStreamUtils").getAuxIdFromPayload(a);if(!this.$24()){var e;(e=this.$7)==null?void 0:e.warn("get data after stream is closed");(e=this.$6)==null?void 0:e.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").RESPONSE,b("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"response_received_after_close"},d);return}(e=this.$6)==null?void 0:e.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").RESPONSE,b("RequestStreamE2EClientLoggerEvent").RECEIVED,{},d);e=a.response.delta;e.forEach(function(a){if(a.data)if(c.$9.flowStatus!==b("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started){var d;(d=c.$7)==null?void 0:d.warn("get data when status is not started")}else c.$3.onData(new TextDecoder("utf-8").decode(a.data.bytes));else if(a.flow_status){d=a.flow_status;c.$28(d)&&c.$3.onFlowStatus(d)}else if(a.termination){d=(d=a.termination.message)!=null?d:"unknown termination msg";c.$2=null;c.shouldTerminateOrRetry(b("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination,d,a.termination.reason===b("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.TryAgain,a.termination.retry_delay_ms!=null?parseInt(a.termination.retry_delay_ms,10):null)}else if(a.log)c.$3.onLog(a.log.message);else if(a.amend_ack){d=a.amend_ack.amendment_id;if(d!=null){if(a.amend_ack.accepted==null){var e;(e=c.$7)==null?void 0:e.warn("missing accepted in amend_ack delta")}e=a.amend_ack.accepted||!1;c.$18.resolve(d,e)}else{(d=c.$7)==null?void 0:d.warn("missing amendment_id in amend_ack delta")}}else if(a.rewrite){e=b("DGWRequestStreamUtils").transformContextWithRewriteDelta(c.$1,a.rewrite,c.$7);a.rewrite.temporary===!0?c.$2=e:c.$1=e}else{(d=c.$7)==null?void 0:d.warn("not support other delta type now: "+Object.keys(a).join(","))}});(e=this.$6)==null?void 0:e.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").RESPONSE,b("RequestStreamE2EClientLoggerEvent").SENT,{},d);a.response.ack_level===b("RequestStreamCommonRequestStreamCommonTypes").AckLevel.Device&&a.response.response_id!=null&&this.$30(a.response.response_id,d)}else{(e=this.$7)==null?void 0:e.warn("Unexpected Payload type");(a=this.$6)==null?void 0:a.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").RESPONSE,b("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"unexpected_payload_type"})}};c.$30=function(a,c){a={ack:{response_id:a,ack:b("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.Success}};a=b("CompactSerializerPolyfill").serialize(a,b("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload);if(this.$12!=null){this.$12.send(a);(a=this.$6)==null?void 0:a.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").RESPONSE_ACK,b("RequestStreamE2EClientLoggerEvent").SENT,{},c)}else{(a=this.$6)==null?void 0:a.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").RESPONSE_ACK,b("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"not_started"},c)}};c.$19=function(){return this.$1.headers.method==="Falco"};c.$26=function(){return new(b("DGWStreamHandler"))(this.$31.bind(this),this.$32.bind(this),this.$33.bind(this),this.$34.bind(this),this.$35.bind(this))};c.$35=function(a){this.$21(b("RequestStreamCloseReason").RequestStreamCloseReason.ServerDataEnd,"Client receive OnServerHasFinishedSendingData and Server will not send more data",!0)};c.$31=function(a){this.$21(b("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination,"Client receive OnClose and Server will not send more data",!0)};c.$32=function(a){try{this.$29(a)}catch(c){(a=this.$6)==null?void 0:a.logE2EEvent(b("RequestStreamE2EClientLoggerMessageType").RESPONSE,b("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:c.message});this.shouldTerminateOrRetry(b("RequestStreamCloseReason").RequestStreamCloseReason.ClientError,c.message,!1)}};c.$33=function(a){var c="",d=!1;switch(a){case b("DGWStream").StreamError.GOING_AWAY:d=!0;c="StreamError: GOING_AWAY";break;case b("DGWStream").StreamError.ABNORMAL_CLOSURE:d=!0;c="StreamError: ABNORMAL_CLOSURE";break;case b("DGWStream").StreamError.KEEPALIVE_TIMEOUT:d=!0;c="StreamError: KEEPALIVE_TIMEOUT";break;case b("DGWStream").StreamError.SERVER_INTERNAL_ERROR:c="StreamError: Received SERVER_INTERNAL_ERROR";break;default:c="StreamError: unknown error"}this.shouldTerminateOrRetry(b("RequestStreamCloseReason").RequestStreamCloseReason.StreamError,c,d)};c.$34=function(a,c){this.shouldTerminateOrRetry(b("RequestStreamCloseReason").RequestStreamCloseReason.ServerDrain,c,!0)};c.$27=function(){var a={};if(b("gkx")("44")){var c=b("RTISubscriptionManagerConfig").bladerunner_www_sandbox;c!=null&&(a[l]=c)}return a};return a}();e.exports=a}),null);
__d("DGWRequestStreamClient",["DGWRequestStreamRef","Promise","RequestStreamE2ESampling"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){}var c=a.prototype;c.createStream=function(a,c,d,e,f){return b("Promise").resolve(new(b("DGWRequestStreamRef"))(a,c,e,f,b("RequestStreamE2ESampling").validateInstrumentationData(a,d,f==null?void 0:f.requestLogContext)))};return a}();e.exports=a}),null);